import{a as l,b as m,o as n,d as P,e as z,_ as De,g as re,R as Te,J as Re,F as D,r as R,A as Ie,t as H,l as S,K as j,L as k,u as _e,j as f,c as X,w as Ee,M as J,z as se,x as Xe,i as Fe,s as Le,v as Ve}from"./index-Cnbi-KVv.js";import{S as Ae}from"./SkinService-BVkUgQoP.js";import{S as Ke}from"./StickersService-gAosSHLX.js";import{u as We}from"./useTitle-BZppf7Xa.js";function ze(s,c){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}class He{skinService=new Ae;stickersService=new Ke;async loadKnives(){const c=new Set;return this.skinService.query({search:"",filters:{category:["sfui_invpanel_filter_melee"]}}).then(e=>(e.items=e.items.filter(a=>c.has(a.skin_id)?!1:(c.add(a.skin_id),!0)),e.items))}async loadTeamStickers(){return this.stickersService.query({search:"",filters:{}}).then(c=>c.items.filter(e=>e.tournament&&e.team&&!e.player))}async loadPlayerStickers(){return this.stickersService.query({search:"",filters:{}}).then(c=>c.items.filter(e=>e.tournament&&e.player))}async loadAllTabsData(){const[c,e,a]=await Promise.all([this.loadKnives(),this.loadTeamStickers(),this.loadPlayerStickers()]),i=[],d=this.processKnives(c);i.push({id:"knives",name:"Knives",showCrates:!0,showOnlyFirstItem:!1,...d});const y=this.processTeamStickers(e);i.push({id:"team-stickers",name:"Team Stickers",showCrates:!1,showOnlyFirstItem:!0,...y});const v=this.processPlayerStickers(a);return i.push({id:"player-stickers",name:"Player Stickers",showCrates:!1,showOnlyFirstItem:!0,...v}),i}processMatrix(c,e){const a=new Set,i=new Map;for(const r of c){const h=e.getColumnValue(r);a.add(h);const p=e.getRowKey(r);i.has(p)||i.set(p,e.getRowItem(r))}const d=Array.from(a).sort(),y=new Map;for(const r of c){const h=e.getColumnValue(r),T=`${e.getRowKey(r)}|${h}`;y.has(T)||y.set(T,{items:[],...e.includeCrates?{crates:[]}:{}});const x=y.get(T);if(x.items.push({id:r.id,name:r.name,image:r.image}),e.includeCrates){const $=e.includeCrates(r);$&&x.crates.push(...$)}}const v=new Map;for(const r of c){const h=e.getRowKey(r),p=e.getColumnValue(r);v.has(h)||v.set(h,new Set),v.get(h).add(p)}const M=d.length,C=new Map,I=Array.from(i.entries()).map(([r,h])=>{const p=String(e.getRowDisplay(h,r)||""),T=v.get(r)?.size||0,x=e.showCountInDisplay?`${p} (${T}/${M})`:p;return C.set(r,x),{key:r,display:p,count:T}}).sort((r,h)=>e.customSort?e.customSort(r,h):h.count!==r.count?h.count-r.count:String(r.display).localeCompare(String(h.display))).map(r=>r.key);return{columns:d,rows:I,rowDisplayMap:C,matrixMap:y}}processTeamStickers(c){return this.processMatrix(c,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.team.name,getRowDisplay:e=>e.team.name,getRowItem:e=>e,showCountInDisplay:!0})}processPlayerStickers(c){return this.processMatrix(c,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.player.name,getRowDisplay:e=>e.player.name,getRowItem:e=>e,showCountInDisplay:!0})}processKnives(c){return this.processMatrix(c,{getColumnValue:e=>e.weapon?.name||"Unknown",getRowKey:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowDisplay:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowItem:e=>e,includeCrates:e=>e.crates,customSort:(e,a)=>e.key==="Vanilla"?-1:a.key==="Vanilla"?1:a.count!==e.count?a.count-e.count:e.display.localeCompare(a.display)})}}const Oe={class:"flex items-center justify-between border-black-300 border-b-2 h-[69px] px-4"},qe={class:"flex items-center gap-2"},Be=P({__name:"MatrixHeader",setup(s){return(c,e)=>(n(),l("div",Oe,[z(De),m("div",qe,[z(re(Te),{to:"/home",class:"flex items-center gap-2 px-3 py-2 rounded-md text-black-100 hover:bg-black-300 hover:text-white transition-colors"},{default:Re(()=>[z(re(ze),{class:"w-5 h-5"}),e[0]||(e[0]=m("span",{class:"text-sm font-medium"},"Back to Home",-1))]),_:1})])]))}}),Ne={class:"inline-flex px-4 py-2 p-1 gap-0 w-full border-b-2 border-black-300"},Ue=["onClick"],je=P({__name:"MatrixTabs",props:{tabs:{},selectedTabId:{}},emits:["select-tab"],setup(s){return(c,e)=>(n(),l("div",Ne,[(n(!0),l(D,null,R(s.tabs,(a,i)=>(n(),l("button",{key:a.id,class:Ie(["px-4 py-2 text-sm font-medium transition-all",s.selectedTabId===a.id?"bg-black-300 text-white rounded shadow-sm":i===0?"bg-black-400 text-black-100 rounded-l":i===s.tabs.length-1?"bg-black-400 text-black-100 rounded-r":"bg-black-400 text-black-100"]),onClick:d=>c.$emit("select-tab",a.id)},H(a.name),11,Ue))),128))]))}}),Pe={key:0,class:"flex flex-col gap-2 items-center justify-center h-full"},Ye={class:"flex flex-wrap gap-1 justify-center"},Ge=["src","alt"],Je={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Qe=["onClick"],Ze=["src","alt"],et={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},tt={key:0,class:"flex flex-wrap gap-1 justify-center"},at=["onClick"],nt=["src","alt"],st={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30"},lt={key:1,class:"text-black-300 text-xs"},ot=P({__name:"MatrixCell",props:{cellData:{},row:{},column:{},showOnlyFirstItem:{type:Boolean},showCrates:{type:Boolean}},emits:["select-item","select-crate"],setup(s){function c(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/62fx62fdpx2x"}function e(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/32fx32fdpx2x"}return(a,i)=>s.cellData?(n(),l("div",Pe,[m("div",Ye,[s.showOnlyFirstItem?(n(),l(D,{key:0},[s.cellData.items.length>0?(n(),l("button",{key:`${s.row}-${s.column}-${s.cellData.items[0].id}`,class:"group relative flex flex-col items-center",onClick:i[1]||(i[1]=d=>a.$emit("select-item",s.cellData.items[0].id))},[m("img",{src:c(s.cellData.items[0].image),alt:s.cellData.items[0].name,draggable:"false",class:"w-24 h-24 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[0]||(i[0]=j(()=>{},["prevent"]))},null,40,Ge),m("div",Je,H(s.cellData.items[0].name),1)])):S("",!0)],64)):(n(!0),l(D,{key:1},R(s.cellData.items,d=>(n(),l("button",{key:`${s.row}-${s.column}-${d.id}`,class:"group relative flex flex-col items-center",onClick:y=>a.$emit("select-item",d.id)},[m("img",{src:c(d.image),alt:d.name,draggable:"false",class:"w-16 h-16 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[2]||(i[2]=j(()=>{},["prevent"]))},null,40,Ze),m("div",et,H(d.name),1)],8,Qe))),128))]),s.showCrates&&s.cellData.crates?(n(),l("div",tt,[(n(!0),l(D,null,R(s.cellData.crates,d=>(n(),l("button",{key:`${s.row}-${s.column}-crate-${d.id}`,class:"group relative",onClick:j(y=>a.$emit("select-crate",d.id),["stop"])},[m("img",{src:e(d.image),alt:d.name,draggable:"false",class:"w-8 h-8 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[3]||(i[3]=j(()=>{},["prevent"]))},null,40,nt),m("div",st,H(d.name),1)],8,at))),128))])):S("",!0)])):(n(),l("span",lt,"â€”"))}}),rt={class:"sticky top-0 z-10 bg-black-400",style:{"box-shadow":"0 2px 0 #212121"}},it={class:"text-xs text-black-100 break-words"},ie=180,ct=P({__name:"MatrixTableHeader",props:{visibleColumns:{},visibleColStart:{},visibleColEnd:{},totalColumns:{}},setup(s){return(c,e)=>(n(),l("thead",rt,[m("tr",null,[e[0]||(e[0]=m("th",{class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px]"},null,-1)),s.visibleColStart>0?(n(),l("th",{key:0,style:k({width:`${s.visibleColStart*ie}px`})},null,4)):S("",!0),(n(!0),l(D,null,R(s.visibleColumns,a=>(n(),l("th",{key:a,class:"border-r border-black-300 px-3 py-2 w-[180px] text-center"},[m("span",it,H(a),1)]))),128)),s.visibleColEnd<s.totalColumns-1?(n(),l("th",{key:1,style:k({width:`${(s.totalColumns-s.visibleColEnd-1)*ie}px`})},null,4)):S("",!0)])]))}}),ut={class:"flex flex-col flex-1 h-full min-w-0"},mt={class:"flex-shrink-0"},dt={key:0,class:"flex-1 flex items-center justify-center"},vt={class:"border-collapse"},ht={class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px] h-[120px] align-middle"},ft={class:"text-sm text-white break-words"},W=120,F=180,U=250,ce=3,ue=2,bt=P({__name:"MatrixView",setup(s){const c=_e(),e=Le(),a=Ve(),i=f(),d=f(),y=f(!0),v=f(0),M=f(!1),C=f(0),Q=f(0),I=f(0),r=f(!1),h=f(!1),p=f([]);function T(){const t=e.query.tab;return t&&p.value.some(u=>u.id===t)?t:p.value[0]?.id||""}const x=f(""),$=X(()=>p.value.find(t=>t.id===x.value)),b=X(()=>$.value?.columns||[]),L=X(()=>$.value?.rows||[]),me=X(()=>$.value?.rowDisplayMap||new Map),de=X(()=>$.value?.matrixMap||new Map),ve=new He,he=f(0),Y=f(0),G=f(0),O=f(0),q=f(0),fe=X(()=>L.value.slice(Y.value,G.value+1)),le=X(()=>b.value.slice(O.value,q.value+1));function V(){if(!i.value||L.value.length===0||b.value.length===0)return;const t=i.value,u=t.clientHeight,o=t.clientWidth,g=t.scrollTop,_=Math.max(0,Math.floor(g/W)-ce),E=Math.min(L.value.length-1,Math.ceil((g+u)/W)+ce),K=-v.value,N=K+o,$e=Math.max(0,Math.floor((K-U)/F)-ue),Se=Math.min(b.value.length-1,Math.ceil((N-U)/F)+ue);Y.value=_,G.value=E,O.value=$e,q.value=Se}function pe(){i.value&&(he.value=i.value.scrollTop,V())}async function we(){y.value=!0;try{p.value=await ve.loadAllTabsData(),x.value===""&&(x.value=T()),J(()=>{V()})}catch(t){console.error("Error loading special items:",t)}finally{y.value=!1}}function ye(t,u){const o=`${t}|${u}`;return de.value.get(o)||null}function xe(t){return me.value.get(t)||t}function be(t){c.getItemDetails(t)}function ge(t){c.getItemDetails(t)}function ke(t){if(t.button!==0)return;const o=t.target.closest("button");o&&o.addEventListener("click",oe,{once:!0,capture:!0}),M.value=!0,r.value=!1,C.value=t.clientX,I.value=v.value,t.preventDefault(),document.addEventListener("mousemove",Z),document.addEventListener("mouseup",ee)}function oe(t){r.value&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}let w=null;function B(){if(!i.value||b.value.length===0)return 0;const t=U+b.value.length*F,u=i.value.clientWidth;if(t<=u)return 0;const o=-(t-u);return Math.round(o)}function Z(t){if(!M.value)return;Math.abs(t.clientX-C.value)>5&&(r.value=!0),w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const o=t.clientX-C.value,g=0,_=B(),E=Math.max(Math.min(I.value+o,g),_);v.value=Math.round(E),w=null}),t.preventDefault()}function ee(){M.value=!1,document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",ee)}function Me(t){if(t.touches.length!==1)return;const o=t.target.closest("button");o&&o.addEventListener("click",oe,{once:!0,capture:!0}),M.value=!0,r.value=!1,h.value=!1,C.value=t.touches[0].clientX,Q.value=t.touches[0].clientY,I.value=v.value,document.addEventListener("touchmove",te,{passive:!1}),document.addEventListener("touchend",ae)}function te(t){if(!M.value||t.touches.length!==1)return;const u=Math.abs(t.touches[0].clientX-C.value),o=Math.abs(t.touches[0].clientY-Q.value);if(Math.sqrt(u*u+o*o)>5&&(r.value=!0),u>10&&u>o)h.value||(h.value=!0),w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const _=t.touches[0].clientX-C.value,E=0,K=B(),N=Math.max(Math.min(I.value+_,E),K);v.value=Math.round(N),w=null}),t.preventDefault();else if(h.value)w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const _=t.touches[0].clientX-C.value,E=0,K=B(),N=Math.max(Math.min(I.value+_,E),K);v.value=Math.round(N),w=null}),t.preventDefault();else return}function ae(){M.value=!1,h.value=!1,document.removeEventListener("touchmove",te),document.removeEventListener("touchend",ae)}let A=null;const Ce=t=>{t.preventDefault(),t.stopPropagation(),A!==null&&cancelAnimationFrame(A),A=requestAnimationFrame(()=>{const o=B(),g=Math.max(Math.min(v.value-t.deltaX,0),o);v.value=Math.round(g),A=null})};function ne(){const u=B(),o=Math.max(Math.min(v.value,0),u);v.value=Math.round(o)}return Ee(async()=>{await we(),await J(),ne(),V()}),se([b,L],async()=>{await J(),ne(),V()}),se(v,()=>{V()}),se(x,t=>{a.replace({query:{...e.query,tab:t}}),v.value=0,i.value&&(i.value.scrollTop=0),J(()=>{ne(),V()})}),Xe(()=>{document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",ee),document.removeEventListener("touchmove",te),document.removeEventListener("touchend",ae),w!==null&&cancelAnimationFrame(w),A!==null&&cancelAnimationFrame(A)}),We("Matrix - Counter-Strike items"),(t,u)=>(n(),l("div",ut,[m("div",mt,[z(Be),y.value?S("",!0):(n(),Fe(je,{key:0,tabs:p.value,"selected-tab-id":x.value,onSelectTab:u[0]||(u[0]=o=>x.value=o)},null,8,["tabs","selected-tab-id"]))]),y.value?(n(),l("div",dt,[...u[1]||(u[1]=[m("svg",{class:"size-8 animate-spin text-white/10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[m("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),m("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(n(),l("div",{key:1,ref_key:"containerRef",ref:i,class:"flex-1 overflow-y-scroll overflow-x-hidden relative min-w-0 max-w-full",style:{height:"0"},onWheel:j(Ce,["shift"]),onMousedown:ke,onTouchstart:Me,onScroll:pe},[m("div",{ref_key:"matrixRef",ref:d,class:"select-none",style:k({minWidth:"max-content",transform:`translateX(${v.value}px)`,transition:M.value?"none":"transform 0.1s ease-out",cursor:M.value?"grabbing":"grab"})},[m("table",vt,[z(ct,{"visible-columns":le.value,"visible-col-start":O.value,"visible-col-end":q.value,"total-columns":b.value.length},null,8,["visible-columns","visible-col-start","visible-col-end","total-columns"]),m("tbody",null,[Y.value>0?(n(),l("tr",{key:0,style:k({height:`${Y.value*W}px`})},[m("td",{style:k({width:`${U}px`})},null,4),(n(!0),l(D,null,R(b.value,o=>(n(),l("td",{key:`spacer-${o}`,style:k({width:`${F}px`})},null,4))),128))],4)):S("",!0),(n(!0),l(D,null,R(fe.value,o=>(n(),l("tr",{key:o,class:"hover:bg-black-300/20 border-b border-black-300/30"},[m("td",ht,[m("span",ft,H(xe(o)),1)]),O.value>0?(n(),l("td",{key:0,style:k({width:`${O.value*F}px`,height:`${W}px`})},null,4)):S("",!0),(n(!0),l(D,null,R(le.value,g=>(n(),l("td",{key:`${o}-${g}`,class:"border-r border-black-300/50 px-2 py-2 w-[180px] h-[120px] align-middle text-center"},[z(ot,{"cell-data":ye(o,g),row:o,column:g,"show-only-first-item":$.value?.showOnlyFirstItem,"show-crates":$.value?.showCrates,onSelectItem:ge,onSelectCrate:be},null,8,["cell-data","row","column","show-only-first-item","show-crates"])]))),128)),q.value<b.value.length-1?(n(),l("td",{key:1,style:k({width:`${(b.value.length-q.value-1)*F}px`,height:`${W}px`})},null,4)):S("",!0)]))),128)),G.value<L.value.length-1?(n(),l("tr",{key:1,style:k({height:`${(L.value.length-G.value-1)*W}px`})},[m("td",{style:k({width:`${U}px`})},null,4),(n(!0),l(D,null,R(b.value,o=>(n(),l("td",{key:`spacer-bottom-${o}`,style:k({width:`${F}px`})},null,4))),128))],4)):S("",!0)])])],4)],544))]))}});export{bt as default};
