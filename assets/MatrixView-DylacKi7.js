import{a as l,b as u,o as n,d as q,e as z,_ as De,g as oe,R as Te,J as Re,F as D,r as R,A as Ie,t as H,l as S,K as j,L as k,u as _e,j as p,c as X,w as Ee,M as G,z as ne,x as Xe,i as Fe,s as Le,v as Ve}from"./index-CZtYFzmi.js";import{S as Ae}from"./SkinService-DKi9p5vT.js";import{S as Ke}from"./StickersService-CsCg1Oim.js";import{u as We}from"./useTitle-1mDuGvNz.js";function ze(s,c){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}class He{skinService=new Ae;stickersService=new Ke;async loadKnives(){const c=new Set;return this.skinService.query({search:"",filters:{category:["sfui_invpanel_filter_melee"]}}).then(e=>(e.items=e.items.filter(a=>c.has(a.skin_id)?!1:(c.add(a.skin_id),!0)),e.items))}async loadTeamStickers(){return this.stickersService.query({search:"",filters:{}}).then(c=>c.items.filter(e=>e.tournament&&e.team&&!e.player))}async loadPlayerStickers(){return this.stickersService.query({search:"",filters:{}}).then(c=>c.items.filter(e=>e.tournament&&e.player))}async loadAllTabsData(){const[c,e,a]=await Promise.all([this.loadKnives(),this.loadTeamStickers(),this.loadPlayerStickers()]),i=[],v=this.processKnives(c);i.push({id:"knives",name:"Knives",showCrates:!0,showOnlyFirstItem:!1,...v});const x=this.processTeamStickers(e);i.push({id:"team-stickers",name:"Team Stickers",showCrates:!1,showOnlyFirstItem:!0,...x});const h=this.processPlayerStickers(a);return i.push({id:"player-stickers",name:"Player Stickers",showCrates:!1,showOnlyFirstItem:!0,...h}),i}processMatrix(c,e){const a=new Set,i=new Map;for(const o of c){const d=e.getColumnValue(o);a.add(d);const f=e.getRowKey(o);i.has(f)||i.set(f,e.getRowItem(o))}const v=Array.from(a).sort(),x=new Map;for(const o of c){const d=e.getColumnValue(o),T=`${e.getRowKey(o)}|${d}`;x.has(T)||x.set(T,{items:[],...e.includeCrates?{crates:[]}:{}});const b=x.get(T);if(b.items.push({id:o.id,name:o.name,image:o.image}),e.includeCrates){const $=e.includeCrates(o);$&&b.crates.push(...$)}}const h=new Map;for(const o of c){const d=e.getRowKey(o),f=e.getColumnValue(o);h.has(d)||h.set(d,new Set),h.get(d).add(f)}const M=v.length,C=new Map,I=Array.from(i.entries()).map(([o,d])=>{const f=String(e.getRowDisplay(d,o)||""),T=h.get(o)?.size||0,b=e.showCountInDisplay?`${f} (${T}/${M})`:f;return C.set(o,b),{key:o,display:f,count:T}}).sort((o,d)=>e.customSort?e.customSort(o,d):d.count!==o.count?d.count-o.count:String(o.display).localeCompare(String(d.display))).map(o=>o.key);return{columns:v,rows:I,rowDisplayMap:C,matrixMap:x}}processTeamStickers(c){return this.processMatrix(c,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.team.name,getRowDisplay:e=>e.team.name,getRowItem:e=>e,showCountInDisplay:!0})}processPlayerStickers(c){return this.processMatrix(c,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.player.name,getRowDisplay:e=>e.player.name,getRowItem:e=>e,showCountInDisplay:!0})}processKnives(c){return this.processMatrix(c,{getColumnValue:e=>e.weapon?.name||"Unknown",getRowKey:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowDisplay:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowItem:e=>e,includeCrates:e=>e.crates,customSort:(e,a)=>e.key==="Vanilla"?-1:a.key==="Vanilla"?1:a.count!==e.count?a.count-e.count:e.display.localeCompare(a.display)})}}const Oe={class:"flex items-center justify-between border-black-300 border-b-2 h-[69px] px-4"},Be={class:"flex items-center gap-2"},Ne=q({__name:"MatrixHeader",setup(s){return(c,e)=>(n(),l("div",Oe,[z(De),u("div",Be,[z(oe(Te),{to:"/home",class:"flex items-center gap-2 px-3 py-2 rounded-md text-black-100 hover:bg-black-300 hover:text-white transition-colors"},{default:Re(()=>[z(oe(ze),{class:"w-5 h-5"}),e[0]||(e[0]=u("span",{class:"text-sm font-medium"},"Back to Home",-1))]),_:1})])]))}}),Ue={class:"inline-flex px-4 py-2 p-1 gap-0 w-full border-b-2 border-black-300"},je=["onClick"],qe=q({__name:"MatrixTabs",props:{tabs:{},selectedTabId:{}},emits:["select-tab"],setup(s){return(c,e)=>(n(),l("div",Ue,[(n(!0),l(D,null,R(s.tabs,(a,i)=>(n(),l("button",{key:a.id,class:Ie(["px-4 py-2 text-sm font-medium transition-all",s.selectedTabId===a.id?"bg-black-300 text-white rounded shadow-sm":i===0?"bg-black-400 text-black-100 rounded-l":i===s.tabs.length-1?"bg-black-400 text-black-100 rounded-r":"bg-black-400 text-black-100"]),onClick:v=>c.$emit("select-tab",a.id)},H(a.name),11,je))),128))]))}}),Pe={key:0,class:"flex flex-col gap-2 items-center justify-center h-full"},Ye={class:"flex flex-wrap gap-1 justify-center"},Ge=["src","alt"],Je={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Qe=["onClick"],Ze=["src","alt"],et={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},tt={key:0,class:"flex flex-wrap gap-1 justify-center"},at=["onClick"],nt=["src","alt"],st={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30"},lt={key:1,class:"text-black-300 text-xs"},ot=q({__name:"MatrixCell",props:{cellData:{},row:{},column:{},showOnlyFirstItem:{type:Boolean},showCrates:{type:Boolean}},emits:["select-item","select-crate"],setup(s){function c(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/62fx62fdpx2x"}function e(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/32fx32fdpx2x"}return(a,i)=>s.cellData?(n(),l("div",Pe,[u("div",Ye,[s.showOnlyFirstItem?(n(),l(D,{key:0},[s.cellData.items.length>0?(n(),l("button",{key:`${s.row}-${s.column}-${s.cellData.items[0].id}`,class:"group relative flex flex-col items-center",onClick:i[1]||(i[1]=v=>a.$emit("select-item",s.cellData.items[0].id))},[u("img",{src:c(s.cellData.items[0].image),alt:s.cellData.items[0].name,draggable:"false",class:"w-24 h-24 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[0]||(i[0]=j(()=>{},["prevent"]))},null,40,Ge),u("div",Je,H(s.cellData.items[0].name),1)])):S("",!0)],64)):(n(!0),l(D,{key:1},R(s.cellData.items,v=>(n(),l("button",{key:`${s.row}-${s.column}-${v.id}`,class:"group relative flex flex-col items-center",onClick:x=>a.$emit("select-item",v.id)},[u("img",{src:c(v.image),alt:v.name,draggable:"false",class:"w-16 h-16 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[2]||(i[2]=j(()=>{},["prevent"]))},null,40,Ze),u("div",et,H(v.name),1)],8,Qe))),128))]),s.showCrates&&s.cellData.crates?(n(),l("div",tt,[(n(!0),l(D,null,R(s.cellData.crates,v=>(n(),l("button",{key:`${s.row}-${s.column}-crate-${v.id}`,class:"group relative",onClick:j(x=>a.$emit("select-crate",v.id),["stop"])},[u("img",{src:e(v.image),alt:v.name,draggable:"false",class:"w-8 h-8 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[3]||(i[3]=j(()=>{},["prevent"]))},null,40,nt),u("div",st,H(v.name),1)],8,at))),128))])):S("",!0)])):(n(),l("span",lt,"â€”"))}}),rt={class:"sticky top-0 z-10 bg-black-400",style:{"box-shadow":"0 2px 0 #212121"}},it={class:"text-xs text-black-100 break-words"},re=180,ct=q({__name:"MatrixTableHeader",props:{visibleColumns:{},visibleColStart:{},visibleColEnd:{},totalColumns:{}},setup(s){return(c,e)=>(n(),l("thead",rt,[u("tr",null,[e[0]||(e[0]=u("th",{class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px]"},null,-1)),s.visibleColStart>0?(n(),l("th",{key:0,style:k({width:`${s.visibleColStart*re}px`})},null,4)):S("",!0),(n(!0),l(D,null,R(s.visibleColumns,a=>(n(),l("th",{key:a,class:"border-r border-black-300 px-3 py-2 w-[180px] text-center"},[u("span",it,H(a),1)]))),128)),s.visibleColEnd<s.totalColumns-1?(n(),l("th",{key:1,style:k({width:`${(s.totalColumns-s.visibleColEnd-1)*re}px`})},null,4)):S("",!0)])]))}}),ut={class:"flex flex-col flex-1 h-full min-w-0"},mt={class:"flex-shrink-0"},dt={key:0,class:"flex-1 flex items-center justify-center"},vt={class:"border-collapse"},ht={class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px] h-[120px] align-middle"},pt={class:"text-sm text-white break-words"},W=120,F=180,U=250,ie=3,ce=2,bt=q({__name:"MatrixView",setup(s){const c=_e(),e=Le(),a=Ve(),i=p(),v=p(),x=p(!0),h=p(0),M=p(!1),C=p(0),J=p(0),I=p(0),o=p(!1),d=p(!1),f=p([]);function T(){const t=e.query.tab;return t&&f.value.some(m=>m.id===t)?t:f.value[0]?.id||""}const b=p(""),$=X(()=>f.value.find(t=>t.id===b.value)),g=X(()=>$.value?.columns||[]),L=X(()=>$.value?.rows||[]),ue=X(()=>$.value?.rowDisplayMap||new Map),me=X(()=>$.value?.matrixMap||new Map),de=new He,ve=p(0),P=p(0),Y=p(0),O=p(0),B=p(0),he=X(()=>L.value.slice(P.value,Y.value+1)),se=X(()=>g.value.slice(O.value,B.value+1));function V(){if(!i.value||L.value.length===0||g.value.length===0)return;const t=i.value,m=t.clientHeight,r=t.clientWidth,y=t.scrollTop,_=Math.max(0,Math.floor(y/W)-ie),E=Math.min(L.value.length-1,Math.ceil((y+m)/W)+ie),K=-h.value,Ce=K+r,$e=Math.max(0,Math.floor((K-U)/F)-ce),Se=Math.min(g.value.length-1,Math.ceil((Ce-U)/F)+ce);P.value=_,Y.value=E,O.value=$e,B.value=Se}function pe(){i.value&&(ve.value=i.value.scrollTop,V())}async function fe(){x.value=!0;try{f.value=await de.loadAllTabsData(),b.value===""&&(b.value=T()),G(()=>{V()})}catch(t){console.error("Error loading special items:",t)}finally{x.value=!1}}function we(t,m){const r=`${t}|${m}`;return me.value.get(r)||null}function ye(t){return ue.value.get(t)||t}function xe(t){c.getItemDetails(t)}function be(t){c.getItemDetails(t)}function ge(t){if(t.button!==0)return;const r=t.target.closest("button");r&&r.addEventListener("click",le,{once:!0,capture:!0}),M.value=!0,o.value=!1,C.value=t.clientX,I.value=h.value,t.preventDefault(),document.addEventListener("mousemove",Q),document.addEventListener("mouseup",Z)}function le(t){o.value&&d.value&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}let w=null;function N(){if(!i.value||g.value.length===0)return 0;const t=U+g.value.length*F,m=i.value.clientWidth;if(t<=m)return 0;const r=-(t-m);return Math.round(r)}function Q(t){if(!M.value)return;Math.abs(t.clientX-C.value)>5&&(o.value=!0),w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const r=t.clientX-C.value,y=0,_=N(),E=Math.max(Math.min(I.value+r,y),_);h.value=Math.round(E),w=null}),t.preventDefault()}function Z(){M.value=!1,document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",Z)}function ke(t){if(t.touches.length!==1)return;const r=t.target.closest("button");r&&r.addEventListener("click",le,{once:!0,capture:!0}),M.value=!0,o.value=!1,d.value=!1,C.value=t.touches[0].clientX,J.value=t.touches[0].clientY,I.value=h.value,document.addEventListener("touchmove",ee,{passive:!1}),document.addEventListener("touchend",te)}function ee(t){if(!M.value||t.touches.length!==1)return;const m=Math.abs(t.touches[0].clientX-C.value),r=Math.abs(t.touches[0].clientY-J.value);if(m>10&&m>r)d.value||(d.value=!0),o.value=!0,w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const y=t.touches[0].clientX-C.value,_=0,E=N(),K=Math.max(Math.min(I.value+y,_),E);h.value=Math.round(K),w=null}),t.preventDefault();else if(d.value)w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const y=t.touches[0].clientX-C.value,_=0,E=N(),K=Math.max(Math.min(I.value+y,_),E);h.value=Math.round(K),w=null}),t.preventDefault();else return}function te(){M.value=!1,d.value=!1,document.removeEventListener("touchmove",ee),document.removeEventListener("touchend",te)}let A=null;const Me=t=>{t.preventDefault(),t.stopPropagation(),A!==null&&cancelAnimationFrame(A),A=requestAnimationFrame(()=>{const r=N(),y=Math.max(Math.min(h.value-t.deltaX,0),r);h.value=Math.round(y),A=null})};function ae(){const m=N(),r=Math.max(Math.min(h.value,0),m);h.value=Math.round(r)}return Ee(async()=>{await fe(),await G(),ae(),V()}),ne([g,L],async()=>{await G(),ae(),V()}),ne(h,()=>{V()}),ne(b,t=>{a.replace({query:{...e.query,tab:t}}),h.value=0,i.value&&(i.value.scrollTop=0),G(()=>{ae(),V()})}),Xe(()=>{document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",Z),document.removeEventListener("touchmove",ee),document.removeEventListener("touchend",te),w!==null&&cancelAnimationFrame(w),A!==null&&cancelAnimationFrame(A)}),We("Matrix - Counter-Strike items"),(t,m)=>(n(),l("div",ut,[u("div",mt,[z(Ne),x.value?S("",!0):(n(),Fe(qe,{key:0,tabs:f.value,"selected-tab-id":b.value,onSelectTab:m[0]||(m[0]=r=>b.value=r)},null,8,["tabs","selected-tab-id"]))]),x.value?(n(),l("div",dt,[...m[1]||(m[1]=[u("svg",{class:"size-8 animate-spin text-white/10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(n(),l("div",{key:1,ref_key:"containerRef",ref:i,class:"flex-1 overflow-y-scroll overflow-x-hidden relative min-w-0 max-w-full",style:{height:"0"},onWheel:j(Me,["shift"]),onMousedown:ge,onTouchstart:ke,onScroll:pe},[u("div",{ref_key:"matrixRef",ref:v,class:"select-none",style:k({minWidth:"max-content",transform:`translateX(${h.value}px)`,transition:M.value?"none":"transform 0.1s ease-out",cursor:M.value?"grabbing":"grab"})},[u("table",vt,[z(ct,{"visible-columns":se.value,"visible-col-start":O.value,"visible-col-end":B.value,"total-columns":g.value.length},null,8,["visible-columns","visible-col-start","visible-col-end","total-columns"]),u("tbody",null,[P.value>0?(n(),l("tr",{key:0,style:k({height:`${P.value*W}px`})},[u("td",{style:k({width:`${U}px`})},null,4),(n(!0),l(D,null,R(g.value,r=>(n(),l("td",{key:`spacer-${r}`,style:k({width:`${F}px`})},null,4))),128))],4)):S("",!0),(n(!0),l(D,null,R(he.value,r=>(n(),l("tr",{key:r,class:"hover:bg-black-300/20 border-b border-black-300/30"},[u("td",ht,[u("span",pt,H(ye(r)),1)]),O.value>0?(n(),l("td",{key:0,style:k({width:`${O.value*F}px`,height:`${W}px`})},null,4)):S("",!0),(n(!0),l(D,null,R(se.value,y=>(n(),l("td",{key:`${r}-${y}`,class:"border-r border-black-300/50 px-2 py-2 w-[180px] h-[120px] align-middle text-center"},[z(ot,{"cell-data":we(r,y),row:r,column:y,"show-only-first-item":$.value?.showOnlyFirstItem,"show-crates":$.value?.showCrates,onSelectItem:be,onSelectCrate:xe},null,8,["cell-data","row","column","show-only-first-item","show-crates"])]))),128)),B.value<g.value.length-1?(n(),l("td",{key:1,style:k({width:`${(g.value.length-B.value-1)*F}px`,height:`${W}px`})},null,4)):S("",!0)]))),128)),Y.value<L.value.length-1?(n(),l("tr",{key:1,style:k({height:`${(L.value.length-Y.value-1)*W}px`})},[u("td",{style:k({width:`${U}px`})},null,4),(n(!0),l(D,null,R(g.value,r=>(n(),l("td",{key:`spacer-bottom-${r}`,style:k({width:`${F}px`})},null,4))),128))],4)):S("",!0)])])],4)],544))]))}});export{bt as default};
