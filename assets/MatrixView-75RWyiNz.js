import{a as l,b as u,o as n,d as N,e as F,_ as $e,g as se,R as Se,J as De,F as D,r as T,A as Te,t as V,l as S,K as H,L as g,u as Re,j as w,c as I,w as Ie,M as q,z as ee,x as _e,i as Ee,s as Xe,v as Le}from"./index-nPW1m-0o.js";import{S as Fe}from"./SkinService-CezuniuI.js";import{S as Ve}from"./StickersService-RdePiE8v.js";import{u as Ae}from"./useTitle-BWXdulxw.js";function Ke(s,c){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}class We{skinService=new Fe;stickersService=new Ve;async loadKnives(){const c=new Set;return this.skinService.query({search:"",filters:{category:["sfui_invpanel_filter_melee"]}}).then(e=>(e.items=e.items.filter(a=>c.has(a.skin_id)?!1:(c.add(a.skin_id),!0)),e.items))}async loadTeamStickers(){return this.stickersService.query({search:"",filters:{}}).then(c=>c.items.filter(e=>e.tournament&&e.team&&!e.player))}async loadPlayerStickers(){return this.stickersService.query({search:"",filters:{}}).then(c=>c.items.filter(e=>e.tournament&&e.player))}async loadAllTabsData(){const[c,e,a]=await Promise.all([this.loadKnives(),this.loadTeamStickers(),this.loadPlayerStickers()]),i=[],m=this.processKnives(c);i.push({id:"knives",name:"Knives",showCrates:!0,showOnlyFirstItem:!1,...m});const y=this.processTeamStickers(e);i.push({id:"team-stickers",name:"Team Stickers",showCrates:!1,showOnlyFirstItem:!0,...y});const v=this.processPlayerStickers(a);return i.push({id:"player-stickers",name:"Player Stickers",showCrates:!1,showOnlyFirstItem:!0,...v}),i}processMatrix(c,e){const a=new Set,i=new Map;for(const o of c){const h=e.getColumnValue(o);a.add(h);const p=e.getRowKey(o);i.has(p)||i.set(p,e.getRowItem(o))}const m=Array.from(a).sort(),y=new Map;for(const o of c){const h=e.getColumnValue(o),x=`${e.getRowKey(o)}|${h}`;y.has(x)||y.set(x,{items:[],...e.includeCrates?{crates:[]}:{}});const f=y.get(x);if(f.items.push({id:o.id,name:o.name,image:o.image}),e.includeCrates){const $=e.includeCrates(o);$&&f.crates.push(...$)}}const v=new Map;for(const o of c){const h=e.getRowKey(o),p=e.getColumnValue(o);v.has(h)||v.set(h,new Set),v.get(h).add(p)}const k=m.length,M=new Map,R=Array.from(i.entries()).map(([o,h])=>{const p=String(e.getRowDisplay(h,o)||""),x=v.get(o)?.size||0,f=e.showCountInDisplay?`${p} (${x}/${k})`:p;return M.set(o,f),{key:o,display:p,count:x}}).sort((o,h)=>e.customSort?e.customSort(o,h):h.count!==o.count?h.count-o.count:String(o.display).localeCompare(String(h.display))).map(o=>o.key);return{columns:m,rows:R,rowDisplayMap:M,matrixMap:y}}processTeamStickers(c){return this.processMatrix(c,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.team.name,getRowDisplay:e=>e.team.name,getRowItem:e=>e,showCountInDisplay:!0})}processPlayerStickers(c){return this.processMatrix(c,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.player.name,getRowDisplay:e=>e.player.name,getRowItem:e=>e,showCountInDisplay:!0})}processKnives(c){return this.processMatrix(c,{getColumnValue:e=>e.weapon?.name||"Unknown",getRowKey:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowDisplay:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowItem:e=>e,includeCrates:e=>e.crates,customSort:(e,a)=>e.key==="Vanilla"?-1:a.key==="Vanilla"?1:a.count!==e.count?a.count-e.count:e.display.localeCompare(a.display)})}}const Oe={class:"flex items-center justify-between border-black-300 border-b-2 h-[69px] px-4"},ze={class:"flex items-center gap-2"},Be=N({__name:"MatrixHeader",setup(s){return(c,e)=>(n(),l("div",Oe,[F($e),u("div",ze,[F(se(Se),{to:"/home",class:"flex items-center gap-2 px-3 py-2 rounded-md text-black-100 hover:bg-black-300 hover:text-white transition-colors"},{default:De(()=>[F(se(Ke),{class:"w-5 h-5"}),e[0]||(e[0]=u("span",{class:"text-sm font-medium"},"Back to Home",-1))]),_:1})])]))}}),He={class:"inline-flex px-4 py-2 p-1 gap-0 w-full border-b-2 border-black-300"},Ne=["onClick"],Ue=N({__name:"MatrixTabs",props:{tabs:{},selectedTabId:{}},emits:["select-tab"],setup(s){return(c,e)=>(n(),l("div",He,[(n(!0),l(D,null,T(s.tabs,(a,i)=>(n(),l("button",{key:a.id,class:Te(["px-4 py-2 text-sm font-medium transition-all",s.selectedTabId===a.id?"bg-black-300 text-white rounded shadow-sm":i===0?"bg-black-400 text-black-100 rounded-l":i===s.tabs.length-1?"bg-black-400 text-black-100 rounded-r":"bg-black-400 text-black-100"]),onClick:m=>c.$emit("select-tab",a.id)},V(a.name),11,Ne))),128))]))}}),je={key:0,class:"flex flex-col gap-2 items-center justify-center h-full"},Pe={class:"flex flex-wrap gap-1 justify-center"},qe=["src","alt"],Ge={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Je=["onClick"],Qe=["src","alt"],Ye={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Ze={key:0,class:"flex flex-wrap gap-1 justify-center"},et=["onClick"],tt=["src","alt"],at={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30"},nt={key:1,class:"text-black-300 text-xs"},st=N({__name:"MatrixCell",props:{cellData:{},row:{},column:{},showOnlyFirstItem:{type:Boolean},showCrates:{type:Boolean}},emits:["select-item","select-crate"],setup(s){function c(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/62fx62fdpx2x"}function e(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/32fx32fdpx2x"}return(a,i)=>s.cellData?(n(),l("div",je,[u("div",Pe,[s.showOnlyFirstItem?(n(),l(D,{key:0},[s.cellData.items.length>0?(n(),l("button",{key:`${s.row}-${s.column}-${s.cellData.items[0].id}`,class:"group relative flex flex-col items-center",onClick:i[1]||(i[1]=m=>a.$emit("select-item",s.cellData.items[0].id))},[u("img",{src:c(s.cellData.items[0].image),alt:s.cellData.items[0].name,draggable:"false",class:"w-24 h-24 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[0]||(i[0]=H(()=>{},["prevent"]))},null,40,qe),u("div",Ge,V(s.cellData.items[0].name),1)])):S("",!0)],64)):(n(!0),l(D,{key:1},T(s.cellData.items,m=>(n(),l("button",{key:`${s.row}-${s.column}-${m.id}`,class:"group relative flex flex-col items-center",onClick:y=>a.$emit("select-item",m.id)},[u("img",{src:c(m.image),alt:m.name,draggable:"false",class:"w-16 h-16 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[2]||(i[2]=H(()=>{},["prevent"]))},null,40,Qe),u("div",Ye,V(m.name),1)],8,Je))),128))]),s.showCrates&&s.cellData.crates?(n(),l("div",Ze,[(n(!0),l(D,null,T(s.cellData.crates,m=>(n(),l("button",{key:`${s.row}-${s.column}-crate-${m.id}`,class:"group relative",onClick:H(y=>a.$emit("select-crate",m.id),["stop"])},[u("img",{src:e(m.image),alt:m.name,draggable:"false",class:"w-8 h-8 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:i[3]||(i[3]=H(()=>{},["prevent"]))},null,40,tt),u("div",at,V(m.name),1)],8,et))),128))])):S("",!0)])):(n(),l("span",nt,"â€”"))}}),lt={class:"sticky top-0 z-10 bg-black-400",style:{"box-shadow":"0 2px 0 #212121"}},ot={class:"text-xs text-black-100 break-words"},le=180,rt=N({__name:"MatrixTableHeader",props:{visibleColumns:{},visibleColStart:{},visibleColEnd:{},totalColumns:{}},setup(s){return(c,e)=>(n(),l("thead",lt,[u("tr",null,[e[0]||(e[0]=u("th",{class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px]"},null,-1)),s.visibleColStart>0?(n(),l("th",{key:0,style:g({width:`${s.visibleColStart*le}px`})},null,4)):S("",!0),(n(!0),l(D,null,T(s.visibleColumns,a=>(n(),l("th",{key:a,class:"border-r border-black-300 px-3 py-2 w-[180px] text-center"},[u("span",ot,V(a),1)]))),128)),s.visibleColEnd<s.totalColumns-1?(n(),l("th",{key:1,style:g({width:`${(s.totalColumns-s.visibleColEnd-1)*le}px`})},null,4)):S("",!0)])]))}}),it={class:"flex flex-col flex-1 h-full min-w-0"},ct={class:"flex-shrink-0"},ut={key:0,class:"flex-1 flex items-center justify-center"},mt={class:"border-collapse"},dt={class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px] h-[120px] align-middle"},vt={class:"text-sm text-white break-words"},L=120,_=180,B=250,oe=3,re=2,yt=N({__name:"MatrixView",setup(s){const c=Re(),e=Xe(),a=Le(),i=w(),m=w(),y=w(!0),v=w(0),k=w(!1),M=w(0),A=w(0),R=w(!1),o=w([]);function h(){const t=e.query.tab;return t&&o.value.some(d=>d.id===t)?t:o.value[0]?.id||""}const p=w(""),x=I(()=>o.value.find(t=>t.id===p.value)),f=I(()=>x.value?.columns||[]),$=I(()=>x.value?.rows||[]),ie=I(()=>x.value?.rowDisplayMap||new Map),ce=I(()=>x.value?.matrixMap||new Map),ue=new We,me=w(0),U=w(0),j=w(0),K=w(0),W=w(0),de=I(()=>$.value.slice(U.value,j.value+1)),te=I(()=>f.value.slice(K.value,W.value+1));function E(){if(!i.value||$.value.length===0||f.value.length===0)return;const t=i.value,d=t.clientHeight,r=t.clientWidth,b=t.scrollTop,O=Math.max(0,Math.floor(b/L)-oe),z=Math.min($.value.length-1,Math.ceil((b+d)/L)+oe),ne=-v.value,ke=ne+r,Ce=Math.max(0,Math.floor((ne-B)/_)-re),Me=Math.min(f.value.length-1,Math.ceil((ke-B)/_)+re);U.value=O,j.value=z,K.value=Ce,W.value=Me}function ve(){i.value&&(me.value=i.value.scrollTop,E())}async function he(){y.value=!0;try{o.value=await ue.loadAllTabsData(),p.value===""&&(p.value=h()),q(()=>{E()})}catch(t){console.error("Error loading special items:",t)}finally{y.value=!1}}function pe(t,d){const r=`${t}|${d}`;return ce.value.get(r)||null}function fe(t){return ie.value.get(t)||t}function we(t){c.getItemDetails(t)}function ye(t){c.getItemDetails(t)}function xe(t){if(t.button!==0)return;const r=t.target.closest("button");r&&r.addEventListener("click",ae,{once:!0,capture:!0}),k.value=!0,R.value=!1,M.value=t.clientX,A.value=v.value,t.preventDefault(),document.addEventListener("mousemove",G),document.addEventListener("mouseup",J)}function ae(t){R.value&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}let C=null;function P(){if(!i.value||f.value.length===0)return 0;const t=B+f.value.length*_,d=i.value.clientWidth;if(t<=d)return 0;const r=-(t-d);return Math.round(r)}function G(t){if(!k.value)return;Math.abs(t.clientX-M.value)>5&&(R.value=!0),C!==null&&cancelAnimationFrame(C),C=requestAnimationFrame(()=>{const r=t.clientX-M.value,b=0,O=P(),z=Math.max(Math.min(A.value+r,b),O);v.value=Math.round(z),C=null}),t.preventDefault()}function J(){k.value=!1,document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",J)}function be(t){if(t.touches.length!==1)return;const r=t.target.closest("button");r&&r.addEventListener("click",ae,{once:!0,capture:!0}),k.value=!0,R.value=!1,M.value=t.touches[0].clientX,A.value=v.value,t.preventDefault(),document.addEventListener("touchmove",Q,{passive:!1}),document.addEventListener("touchend",Y)}function Q(t){if(!k.value||t.touches.length!==1)return;Math.abs(t.touches[0].clientX-M.value)>5&&(R.value=!0),C!==null&&cancelAnimationFrame(C),C=requestAnimationFrame(()=>{const r=t.touches[0].clientX-M.value,b=0,O=P(),z=Math.max(Math.min(A.value+r,b),O);v.value=Math.round(z),C=null}),t.preventDefault()}function Y(){k.value=!1,document.removeEventListener("touchmove",Q),document.removeEventListener("touchend",Y)}let X=null;const ge=t=>{t.preventDefault(),t.stopPropagation(),X!==null&&cancelAnimationFrame(X),X=requestAnimationFrame(()=>{const r=P(),b=Math.max(Math.min(v.value-t.deltaX,0),r);v.value=Math.round(b),X=null})};function Z(){const d=P(),r=Math.max(Math.min(v.value,0),d);v.value=Math.round(r)}return Ie(async()=>{await he(),await q(),Z(),E()}),ee([f,$],async()=>{await q(),Z(),E()}),ee(v,()=>{E()}),ee(p,t=>{a.replace({query:{...e.query,tab:t}}),v.value=0,i.value&&(i.value.scrollTop=0),q(()=>{Z(),E()})}),_e(()=>{document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",J),document.removeEventListener("touchmove",Q),document.removeEventListener("touchend",Y),C!==null&&cancelAnimationFrame(C),X!==null&&cancelAnimationFrame(X)}),Ae("Matrix - Counter-Strike items"),(t,d)=>(n(),l("div",it,[u("div",ct,[F(Be),y.value?S("",!0):(n(),Ee(Ue,{key:0,tabs:o.value,"selected-tab-id":p.value,onSelectTab:d[0]||(d[0]=r=>p.value=r)},null,8,["tabs","selected-tab-id"]))]),y.value?(n(),l("div",ut,[...d[1]||(d[1]=[u("svg",{class:"size-8 animate-spin text-white/10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(n(),l("div",{key:1,ref_key:"containerRef",ref:i,class:"flex-1 overflow-y-scroll overflow-x-hidden relative min-w-0 max-w-full",style:{height:"0"},onWheel:H(ge,["shift"]),onMousedown:xe,onTouchstart:be,onScroll:ve},[u("div",{ref_key:"matrixRef",ref:m,class:"select-none",style:g({minWidth:"max-content",transform:`translateX(${v.value}px)`,transition:k.value?"none":"transform 0.1s ease-out",cursor:k.value?"grabbing":"grab"})},[u("table",mt,[F(rt,{"visible-columns":te.value,"visible-col-start":K.value,"visible-col-end":W.value,"total-columns":f.value.length},null,8,["visible-columns","visible-col-start","visible-col-end","total-columns"]),u("tbody",null,[U.value>0?(n(),l("tr",{key:0,style:g({height:`${U.value*L}px`})},[u("td",{style:g({width:`${B}px`})},null,4),(n(!0),l(D,null,T(f.value,r=>(n(),l("td",{key:`spacer-${r}`,style:g({width:`${_}px`})},null,4))),128))],4)):S("",!0),(n(!0),l(D,null,T(de.value,r=>(n(),l("tr",{key:r,class:"hover:bg-black-300/20 border-b border-black-300/30"},[u("td",dt,[u("span",vt,V(fe(r)),1)]),K.value>0?(n(),l("td",{key:0,style:g({width:`${K.value*_}px`,height:`${L}px`})},null,4)):S("",!0),(n(!0),l(D,null,T(te.value,b=>(n(),l("td",{key:`${r}-${b}`,class:"border-r border-black-300/50 px-2 py-2 w-[180px] h-[120px] align-middle text-center"},[F(st,{"cell-data":pe(r,b),row:r,column:b,"show-only-first-item":x.value?.showOnlyFirstItem,"show-crates":x.value?.showCrates,onSelectItem:ye,onSelectCrate:we},null,8,["cell-data","row","column","show-only-first-item","show-crates"])]))),128)),W.value<f.value.length-1?(n(),l("td",{key:1,style:g({width:`${(f.value.length-W.value-1)*_}px`,height:`${L}px`})},null,4)):S("",!0)]))),128)),j.value<$.value.length-1?(n(),l("tr",{key:1,style:g({height:`${($.value.length-j.value-1)*L}px`})},[u("td",{style:g({width:`${B}px`})},null,4),(n(!0),l(D,null,T(f.value,r=>(n(),l("td",{key:`spacer-bottom-${r}`,style:g({width:`${_}px`})},null,4))),128))],4)):S("",!0)])])],4)],544))]))}});export{yt as default};
