var De=Object.defineProperty;var Te=(n,s,e)=>s in n?De(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e;var ne=(n,s,e)=>Te(n,typeof s!="symbol"?s+"":s,e);import{d as j,y as r,J as H,A as d,x as re,U as Re,O as Ie,z as l,F as S,I as D,G as _e,H as O,E as $,a1 as P,K as M,o as Ee,n as J,f as se,b as Xe,N as Fe,r as p,c as _,C as Le,D as Ve}from"./vue-vendor-BDz4696B.js";import{S as Ae}from"./SkinService-CJIo-Lbx.js";import{S as Ke}from"./StickersService-DueFPvel.js";import{_ as He,e as Oe,u as We}from"./index-C6K9UzRG.js";import{u as ze}from"./useTitle-BFdHc6BK.js";import"./utils-vendor-DMCOh9hm.js";import"./search-Dw8P0qyA.js";import"./vueuse-DFZpnpvQ.js";class Ne{constructor(){ne(this,"skinService",new Ae);ne(this,"stickersService",new Ke)}async loadKnives(){const s=new Set;return this.skinService.query({search:"",filters:{category:["sfui_invpanel_filter_melee"]}}).then(e=>(e.items=e.items.filter(a=>s.has(a.skin_id)?!1:(s.add(a.skin_id),!0)),e.items))}async loadTeamStickers(){return this.stickersService.query({search:"",filters:{}}).then(s=>s.items.filter(e=>e.tournament&&e.team&&!e.player))}async loadPlayerStickers(){return this.stickersService.query({search:"",filters:{}}).then(s=>s.items.filter(e=>e.tournament&&e.player))}async loadAllTabsData(){const[s,e,a]=await Promise.all([this.loadKnives(),this.loadTeamStickers(),this.loadPlayerStickers()]),c=[],m=this.processKnives(s);c.push({id:"knives",name:"Knives",showCrates:!0,showOnlyFirstItem:!1,...m});const v=this.processTeamStickers(e);c.push({id:"team-stickers",name:"Team Stickers",showCrates:!1,showOnlyFirstItem:!0,...v});const f=this.processPlayerStickers(a);return c.push({id:"player-stickers",name:"Player Stickers",showCrates:!1,showOnlyFirstItem:!0,...f}),c}processMatrix(s,e){const a=new Set,c=new Map;for(const i of s){const h=e.getColumnValue(i);a.add(h);const b=e.getRowKey(i);c.has(b)||c.set(b,e.getRowItem(i))}const m=Array.from(a).sort(),v=new Map;for(const i of s){const h=e.getColumnValue(i),x=`${e.getRowKey(i)}|${h}`;v.has(x)||v.set(x,{items:[],...e.includeCrates?{crates:[]}:{}});const g=v.get(x);if(g.items.push({id:i.id,name:i.name,image:i.image}),e.includeCrates){const y=e.includeCrates(i);y&&g.crates.push(...y)}}const f=new Map;for(const i of s){const h=e.getRowKey(i),b=e.getColumnValue(i);f.has(h)||f.set(h,new Set),f.get(h).add(b)}const C=m.length,W=new Map,T=Array.from(c.entries()).map(([i,h])=>{const b=String(e.getRowDisplay(h,i)||""),x=f.get(i)?.size||0,g=e.showCountInDisplay?`${b} (${x}/${C})`:b;return W.set(i,g),{key:i,display:b,count:x}}).sort((i,h)=>e.customSort?e.customSort(i,h):h.count!==i.count?h.count-i.count:String(i.display).localeCompare(String(h.display))).map(i=>i.key);return{columns:m,rows:T,rowDisplayMap:W,matrixMap:v}}processTeamStickers(s){return this.processMatrix(s,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.team.name,getRowDisplay:e=>e.team.name,getRowItem:e=>e,showCountInDisplay:!0})}processPlayerStickers(s){return this.processMatrix(s,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.player.name,getRowDisplay:e=>e.player.name,getRowItem:e=>e,showCountInDisplay:!0})}processKnives(s){return this.processMatrix(s,{getColumnValue:e=>e.weapon?.name||"Unknown",getRowKey:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowDisplay:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowItem:e=>e,includeCrates:e=>e.crates,customSort:(e,a)=>e.key==="Vanilla"?-1:a.key==="Vanilla"?1:a.count!==e.count?a.count-e.count:e.display.localeCompare(a.display)})}}const Ue={class:"flex items-center justify-between border-black-300 border-b-2 h-[69px] px-4"},qe={class:"flex items-center gap-2"},Be=j({__name:"MatrixHeader",setup(n){return(s,e)=>(l(),r("div",Ue,[H(He),d("div",qe,[H(re(Re),{to:"/home",class:"flex items-center gap-2 px-3 py-2 rounded-md text-black-100 hover:bg-black-300 hover:text-white transition-colors"},{default:Ie(()=>[H(re(Oe),{class:"w-5 h-5"}),e[0]||(e[0]=d("span",{class:"text-sm font-medium"},"Back to Home",-1))]),_:1})])]))}}),Pe={class:"inline-flex px-4 py-2 p-1 gap-0 w-full border-b-2 border-black-300"},je=["onClick"],Ye=j({__name:"MatrixTabs",props:{tabs:{},selectedTabId:{}},emits:["select-tab"],setup(n){return(s,e)=>(l(),r("div",Pe,[(l(!0),r(S,null,D(n.tabs,(a,c)=>(l(),r("button",{key:a.id,class:_e(["px-4 py-2 text-sm font-medium transition-all",n.selectedTabId===a.id?"bg-black-300 text-white rounded shadow-sm":c===0?"bg-black-400 text-black-100 rounded-l":c===n.tabs.length-1?"bg-black-400 text-black-100 rounded-r":"bg-black-400 text-black-100"]),onClick:m=>s.$emit("select-tab",a.id)},O(a.name),11,je))),128))]))}}),Ge={key:0,class:"flex flex-col gap-2 items-center justify-center h-full"},Je={class:"flex flex-wrap gap-1 justify-center"},Qe=["src","alt"],Ze={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},et=["onClick"],tt=["src","alt"],at={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},nt={key:0,class:"flex flex-wrap gap-1 justify-center"},st=["onClick"],lt=["src","alt"],ot={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30"},rt={key:1,class:"text-black-300 text-xs"},it=j({__name:"MatrixCell",props:{cellData:{},row:{},column:{},showOnlyFirstItem:{type:Boolean},showCrates:{type:Boolean}},emits:["select-item","select-crate"],setup(n){function s(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/62fx62fdpx2x"}function e(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/32fx32fdpx2x"}return(a,c)=>n.cellData?(l(),r("div",Ge,[d("div",Je,[n.showOnlyFirstItem?(l(),r(S,{key:0},[n.cellData.items.length>0?(l(),r("button",{key:`${n.row}-${n.column}-${n.cellData.items[0].id}`,class:"group relative flex flex-col items-center",onClick:c[1]||(c[1]=m=>a.$emit("select-item",n.cellData.items[0].id))},[d("img",{src:s(n.cellData.items[0].image),alt:n.cellData.items[0].name,draggable:"false",class:"w-24 h-24 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:c[0]||(c[0]=P(()=>{},["prevent"]))},null,40,Qe),d("div",Ze,O(n.cellData.items[0].name),1)])):$("",!0)],64)):(l(!0),r(S,{key:1},D(n.cellData.items,m=>(l(),r("button",{key:`${n.row}-${n.column}-${m.id}`,class:"group relative flex flex-col items-center",onClick:v=>a.$emit("select-item",m.id)},[d("img",{src:s(m.image),alt:m.name,draggable:"false",class:"w-16 h-16 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:c[2]||(c[2]=P(()=>{},["prevent"]))},null,40,tt),d("div",at,O(m.name),1)],8,et))),128))]),n.showCrates&&n.cellData.crates?(l(),r("div",nt,[(l(!0),r(S,null,D(n.cellData.crates,m=>(l(),r("button",{key:`${n.row}-${n.column}-crate-${m.id}`,class:"group relative",onClick:P(v=>a.$emit("select-crate",m.id),["stop"])},[d("img",{src:e(m.image),alt:m.name,draggable:"false",class:"w-8 h-8 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:c[3]||(c[3]=P(()=>{},["prevent"]))},null,40,lt),d("div",ot,O(m.name),1)],8,st))),128))])):$("",!0)])):(l(),r("span",rt,"â€”"))}}),ct={class:"sticky top-0 z-10 bg-black-400",style:{"box-shadow":"0 2px 0 #212121"}},ut={class:"text-xs text-black-100 break-words"},ie=180,mt=j({__name:"MatrixTableHeader",props:{visibleColumns:{},visibleColStart:{},visibleColEnd:{},totalColumns:{}},setup(n){return(s,e)=>(l(),r("thead",ct,[d("tr",null,[e[0]||(e[0]=d("th",{class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px]"},null,-1)),n.visibleColStart>0?(l(),r("th",{key:0,style:M({width:`${n.visibleColStart*ie}px`})},null,4)):$("",!0),(l(!0),r(S,null,D(n.visibleColumns,a=>(l(),r("th",{key:a,class:"border-r border-black-300 px-3 py-2 w-[180px] text-center"},[d("span",ut,O(a),1)]))),128)),n.visibleColEnd<n.totalColumns-1?(l(),r("th",{key:1,style:M({width:`${(n.totalColumns-n.visibleColEnd-1)*ie}px`})},null,4)):$("",!0)])]))}}),dt={class:"flex flex-col flex-1 h-full min-w-0"},vt={class:"flex-shrink-0"},ht={key:0,class:"flex-1 flex items-center justify-center"},pt={class:"border-collapse"},ft={class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px] h-[120px] align-middle"},yt={class:"text-sm text-white break-words"},K=120,E=180,B=250,ce=3,ue=2,Dt=j({__name:"MatrixView",setup(n){const s=We(),e=Le(),a=Ve(),c=p(),m=p(!0),v=p(0),f=p(!1),C=p(0),W=p(0),X=p(0),T=p(!1),i=p(!1),h=p([]);function b(){const t=e.query.tab;return t&&h.value.some(u=>u.id===t)?t:h.value[0]?.id||""}const x=p(""),g=_(()=>h.value.find(t=>t.id===x.value)),y=_(()=>g.value?.columns||[]),F=_(()=>g.value?.rows||[]),me=_(()=>g.value?.rowDisplayMap||new Map),de=_(()=>g.value?.matrixMap||new Map),ve=new Ne,he=p(0),Y=p(0),G=p(0),z=p(0),N=p(0),pe=_(()=>F.value.slice(Y.value,G.value+1)),le=_(()=>y.value.slice(z.value,N.value+1));function L(){if(!c.value||F.value.length===0||y.value.length===0)return;const t=c.value,u=t.clientHeight,o=t.clientWidth,k=t.scrollTop,R=Math.max(0,Math.floor(k/K)-ce),I=Math.min(F.value.length-1,Math.ceil((k+u)/K)+ce),A=-v.value,q=A+o,$e=Math.max(0,Math.floor((A-B)/E)-ue),Se=Math.min(y.value.length-1,Math.ceil((q-B)/E)+ue);Y.value=R,G.value=I,z.value=$e,N.value=Se}function fe(){c.value&&(he.value=c.value.scrollTop,L())}async function ye(){m.value=!0;try{h.value=await ve.loadAllTabsData(),x.value===""&&(x.value=b()),J(()=>{L()})}catch(t){console.error("Error loading special items:",t)}finally{m.value=!1}}function we(t,u){const o=`${t}|${u}`;return de.value.get(o)||null}function xe(t){return me.value.get(t)||t}function be(t){s.getItemDetails(t)}function ge(t){s.getItemDetails(t)}function ke(t){if(t.button!==0)return;const o=t.target.closest("button");o&&o.addEventListener("click",oe,{once:!0,capture:!0}),f.value=!0,T.value=!1,C.value=t.clientX,X.value=v.value,t.preventDefault(),document.addEventListener("mousemove",Q),document.addEventListener("mouseup",Z)}function oe(t){T.value&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}let w=null;function U(){if(!c.value||y.value.length===0)return 0;const t=B+y.value.length*E,u=c.value.clientWidth;if(t<=u)return 0;const o=-(t-u);return Math.round(o)}function Q(t){if(!f.value)return;Math.abs(t.clientX-C.value)>5&&(T.value=!0),w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const o=t.clientX-C.value,k=0,R=U(),I=Math.max(Math.min(X.value+o,k),R);v.value=Math.round(I),w=null}),t.preventDefault()}function Z(){f.value=!1,document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",Z)}function Me(t){if(t.touches.length!==1)return;const o=t.target.closest("button");o&&o.addEventListener("click",oe,{once:!0,capture:!0}),f.value=!0,T.value=!1,i.value=!1,C.value=t.touches[0].clientX,W.value=t.touches[0].clientY,X.value=v.value,document.addEventListener("touchmove",ee,{passive:!1}),document.addEventListener("touchend",te)}function ee(t){if(!f.value||t.touches.length!==1)return;const u=Math.abs(t.touches[0].clientX-C.value),o=Math.abs(t.touches[0].clientY-W.value);if(Math.sqrt(u*u+o*o)>5&&(T.value=!0),u>10&&u>o)i.value||(i.value=!0),w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const R=t.touches[0].clientX-C.value,I=0,A=U(),q=Math.max(Math.min(X.value+R,I),A);v.value=Math.round(q),w=null}),t.preventDefault();else if(i.value)w!==null&&cancelAnimationFrame(w),w=requestAnimationFrame(()=>{const R=t.touches[0].clientX-C.value,I=0,A=U(),q=Math.max(Math.min(X.value+R,I),A);v.value=Math.round(q),w=null}),t.preventDefault();else return}function te(){f.value=!1,i.value=!1,document.removeEventListener("touchmove",ee),document.removeEventListener("touchend",te)}let V=null;const Ce=t=>{t.preventDefault(),t.stopPropagation(),V!==null&&cancelAnimationFrame(V),V=requestAnimationFrame(()=>{const o=U(),k=Math.max(Math.min(v.value-t.deltaX,0),o);v.value=Math.round(k),V=null})};function ae(){const u=U(),o=Math.max(Math.min(v.value,0),u);v.value=Math.round(o)}return Ee(async()=>{await ye(),await J(),ae(),L()}),se([y,F],async()=>{await J(),ae(),L()}),se(v,()=>{L()}),se(x,t=>{a.replace({query:{...e.query,tab:t}}),v.value=0,c.value&&(c.value.scrollTop=0),J(()=>{ae(),L()})}),Xe(()=>{document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",Z),document.removeEventListener("touchmove",ee),document.removeEventListener("touchend",te),w!==null&&cancelAnimationFrame(w),V!==null&&cancelAnimationFrame(V)}),ze("Matrix - Counter-Strike items"),(t,u)=>(l(),r("div",dt,[d("div",vt,[H(Be),m.value?$("",!0):(l(),Fe(Ye,{key:0,tabs:h.value,"selected-tab-id":x.value,onSelectTab:u[0]||(u[0]=o=>x.value=o)},null,8,["tabs","selected-tab-id"]))]),m.value?(l(),r("div",ht,[...u[1]||(u[1]=[d("svg",{class:"size-8 animate-spin text-white/10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(l(),r("div",{key:1,ref_key:"containerRef",ref:c,class:"flex-1 overflow-y-scroll overflow-x-hidden relative min-w-0 max-w-full",style:{height:"0"},onWheel:P(Ce,["shift"]),onMousedown:ke,onTouchstart:Me,onScroll:fe},[d("div",{class:"select-none",style:M({minWidth:"max-content",transform:`translateX(${v.value}px)`,transition:f.value?"none":"transform 0.1s ease-out",cursor:f.value?"grabbing":"grab"})},[d("table",pt,[H(mt,{"visible-columns":le.value,"visible-col-start":z.value,"visible-col-end":N.value,"total-columns":y.value.length},null,8,["visible-columns","visible-col-start","visible-col-end","total-columns"]),d("tbody",null,[Y.value>0?(l(),r("tr",{key:0,style:M({height:`${Y.value*K}px`})},[d("td",{style:M({width:`${B}px`})},null,4),(l(!0),r(S,null,D(y.value,o=>(l(),r("td",{key:`spacer-${o}`,style:M({width:`${E}px`})},null,4))),128))],4)):$("",!0),(l(!0),r(S,null,D(pe.value,o=>(l(),r("tr",{key:o,class:"hover:bg-black-300/20 border-b border-black-300/30"},[d("td",ft,[d("span",yt,O(xe(o)),1)]),z.value>0?(l(),r("td",{key:0,style:M({width:`${z.value*E}px`,height:`${K}px`})},null,4)):$("",!0),(l(!0),r(S,null,D(le.value,k=>(l(),r("td",{key:`${o}-${k}`,class:"border-r border-black-300/50 px-2 py-2 w-[180px] h-[120px] align-middle text-center"},[H(it,{"cell-data":we(o,k),row:o,column:k,"show-only-first-item":g.value?.showOnlyFirstItem,"show-crates":g.value?.showCrates,onSelectItem:ge,onSelectCrate:be},null,8,["cell-data","row","column","show-only-first-item","show-crates"])]))),128)),N.value<y.value.length-1?(l(),r("td",{key:1,style:M({width:`${(y.value.length-N.value-1)*E}px`,height:`${K}px`})},null,4)):$("",!0)]))),128)),G.value<F.value.length-1?(l(),r("tr",{key:1,style:M({height:`${(F.value.length-G.value-1)*K}px`})},[d("td",{style:M({width:`${B}px`})},null,4),(l(!0),r(S,null,D(y.value,o=>(l(),r("td",{key:`spacer-bottom-${o}`,style:M({width:`${E}px`})},null,4))),128))],4)):$("",!0)])])],4)],544))]))}});export{Dt as default};
