import{c as i,b as f,o as l,d as V,n as g,w as U,p as A,q as b,s as z,e as $,g as d,f as E,t as F,v as D,x as N,F as S,r as C,y as R,z as P,i as L,A as Q,a as x,B as K,C as Z,D as G,E as H,G as J,I as W,u as X}from"./index-C-ui4iUh.js";import{a as Y,_}from"./ItemsSkeleton.vue_vue_type_script_setup_true_lang-Byv4r1xE.js";import{u as ee}from"./useTitle-VL7wtkIG.js";function te(e,a){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function se(e,a){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}function le(e,a){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const oe={class:"relative"},ne={class:"absolute left-0 flex items-center h-full px-2"},re={class:"absolute right-0 flex items-center h-full gap-2 px-3"},ie={key:0,class:"px-2 text-sm text-white rounded-md bg-black-200 hidden sm:block"},ae={class:"font-semibold"},ue={key:1,class:"w-20 h-6 px-2 rounded-md bg-black-200 animate-pulse"},ce={key:2,class:"w-0.5 h-[calc(100%-20px)] rounded-full bg-black-200/20"},de={key:0,class:"absolute top-1 right-1 bg-[#ff5e65] size-2 rounded-full"},fe={key:0,class:"flex gap-2 overflow-x-auto pb-0.5"},me={class:""},ve={class:"flex items-center gap-1 flex-wrap"},he=["onClick"],pe=V({__name:"SearchBar",props:{query:{},total:{},scrolledDown:{type:Boolean},hasFilters:{type:Boolean},hasSelectedFilters:{type:Boolean},loading:{type:Boolean},filters:{},filtersValues:{}},emits:["input","open-filters","remove-filter"],setup(e){const a=e,t=g(a.query||"");return U(()=>a.query,m=>{t.value=m}),(m,s)=>(l(),i("div",{class:A(["sticky top-0 left-0 right-0 px-5 pt-3 pb-2 duration-300 z-10 gap-2 flex flex-col",[e.scrolledDown?"bg-black-300 shadow-lg":"bg-transparent"]])},[f("div",oe,[f("div",ne,[$(d(le),{class:"w-6 h-6 text-black-200"})]),f("div",re,[e.loading?(l(),i("div",ue)):(l(),i("p",ie,[s[3]||(s[3]=E(" total ",-1)),f("span",ae,F(e.total),1)])),e.hasFilters?(l(),i("div",ce)):b("",!0),e.hasFilters?(l(),i("button",{key:3,type:"button",class:"p-1 rounded-md hover:bg-black-200 relative",onClick:s[0]||(s[0]=n=>m.$emit("open-filters"))},[$(d(se),{class:"w-6 h-6 text-black-100"}),e.hasSelectedFilters?(l(),i("div",de)):b("",!0)])):b("",!0)]),z(f("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>t.value=n),class:"w-full h-full py-4 pl-12 pr-36 sm:pr-60 text-white border-0 rounded-md outline-none bg-black-300 focus:outline-none sm:text-sm focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent",type:"text",placeholder:"Search...",onKeyup:s[2]||(s[2]=N(n=>m.$emit("input",t.value),["enter"]))},null,544),[[D,t.value]])]),e.hasSelectedFilters?(l(),i("div",fe,[(l(!0),i(S,null,C(e.filtersValues,(n,o)=>(l(),i("div",{key:o,class:"flex items-center gap-1 text-sm p-1 flex-shrink-0 text-white rounded-md bg-black-300"},[f("div",me,F(e.filters.find(u=>u.prop===o)?.name||o),1),f("div",ve,[(l(!0),i(S,null,C(n,u=>(l(),i("button",{key:u,type:"button",class:"text-white bg-black-200 px-1 rounded-md flex items-center gap-1",onClick:c=>m.$emit("remove-filter",{prop:o,value:u})},[$(d(R),{class:"size-4 text-white"}),E(" "+F(e.filters.find(c=>c.prop===o)?.options.find(c=>c.id===u)?.name||u),1)],8,he))),128))])]))),128))])):b("",!0)],2))}}),ge={class:"flex flex-col"},ye=["src","alt"],be={key:0,class:"absolute inset-0 bg-black-300 rounded-md animate-pulse"},ke={key:1,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-20 rounded-md"},xe=["src"],we=["title"],$e=V({__name:"ItemVideo",props:{name:{},video:{},thumbnail:{}},emits:["show"],setup(e){const a=g(!1),t=g(!1);function m(){a.value=!0}return(s,n)=>(l(),i("div",ge,[a.value?b("",!0):(l(),i("div",{key:0,class:"relative w-full aspect-video rounded-md cursor-pointer bg-gray-800",onClick:m},[f("img",{src:e.thumbnail,alt:e.name,class:"w-full h-full object-cover rounded-md",loading:"lazy",onLoad:n[0]||(n[0]=o=>t.value=!0),onError:n[1]||(n[1]=o=>t.value=!0)},null,40,ye),t.value?b("",!0):(l(),i("div",be)),t.value?(l(),i("div",ke,[...n[2]||(n[2]=[f("div",{class:"w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all"},[f("svg",{class:"w-8 h-8 text-black ml-1",fill:"currentColor",viewBox:"0 0 24 24"},[f("path",{d:"M8 5v14l11-7z"})])],-1)])])):b("",!0)])),a.value?(l(),i("video",{key:1,class:"object-cover w-full h-full rounded-md",src:e.video,autoplay:"",muted:"",playsinline:"",controls:""},null,8,xe)):b("",!0),f("div",null,[f("p",{class:"text-sm truncate px-0.5 mt-1.5 text-white",title:e.name},F(e.name),9,we)])]))}}),Fe={class:"relative flex-1 w-full"},Ve={key:3,class:"py-10"},Se=V({__name:"ItemsList",props:{items:{},itemsCount:{},loading:{type:Boolean},search:{},hasFilters:{type:Boolean,default:!1},hasSelectedFilters:{type:Boolean,default:!1},filters:{},filtersValues:{},isVideo:{type:Boolean,default:!1},hasSearch:{type:Boolean,default:!0}},emits:["set-query","select","load-more","open-filters","remove-filter"],setup(e,{emit:a}){const t=a,m=g(null),{y:s}=P(m),n=g(!1);function o(u){n.value=u,u===!0&&t("load-more")}return(u,c)=>(l(),i("div",Fe,[e.hasSearch?(l(),L(pe,{key:0,query:e.search,"scrolled-down":d(s)>40,total:e.itemsCount,loading:e.loading,"has-filters":e.hasFilters,"has-selected-filters":e.hasSelectedFilters,filters:e.filters,"filters-values":e.filtersValues,onInput:c[0]||(c[0]=r=>u.$emit("set-query",r)),onOpenFilters:c[1]||(c[1]=r=>u.$emit("open-filters")),onRemoveFilter:c[2]||(c[2]=r=>u.$emit("remove-filter",r))},null,8,["query","scrolled-down","total","loading","has-filters","has-selected-filters","filters","filters-values"])):b("",!0),f("div",{ref_key:"el",ref:m,class:A(["grid w-full gap-3 p-4 px-5 pb-32 mx-auto overflow-y-scroll h-[calc(100vh-69px)]",{"grid-cols-1 lg:grid-cols-2 xl:grid-cols-3":e.isVideo,"items-grid-small md:items-grid":!e.isVideo}])},[e.isVideo?(l(!0),i(S,{key:1},C(e.items,r=>(l(),L($e,{key:r.id,name:r.name,video:r.video,thumbnail:r.thumbnail},null,8,["name","video","thumbnail"]))),128)):(l(!0),i(S,{key:0},C(e.items,r=>(l(),L(_,{id:r.id,key:r.id,name:r.name,image:r.image,souvenir:r?.souvenir??!1,stattrak:r?.stattrak??!1,rare:r?.rare??!1,genuine:r?.genuine??!1,"market-hash-name":r.market_hash_name,onShow:p=>u.$emit("select",r.id)},null,8,["id","name","image","souvenir","stattrak","rare","genuine","market-hash-name","onShow"]))),128)),e.loading?(l(),L(Y,{key:2})):b("",!0),e.loading?b("",!0):z((l(),i("div",Ve,null,512)),[[d(Q),o]])],2)]))}}),Ce=["value","checked","onChange"],qe=V({__name:"MultiSelectFilter",props:{options:{},values:{}},emits:["update:values"],setup(e,{emit:a}){const t=e,m=a,s=g(""),n=x(()=>t.options.filter(c=>c.name.toLocaleLowerCase().includes(s.value.toLocaleLowerCase()))),o=c=>{const r=t.values,p=r.indexOf(c);p===-1?r.push(c):r.splice(p,1),m("update:values",r)},u=c=>t.values.includes(c);return(c,r)=>(l(),i("div",null,[z(f("input",{"onUpdate:modelValue":r[0]||(r[0]=p=>s.value=p),class:"w-full h-full py-3 text-white rounded-md outline-none bg-black-300 border-2 border-black-300 focus:outline-none mb-4 sm:text-sm focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent",type:"text",placeholder:"Search to filter..."},null,512),[[D,s.value]]),(l(!0),i(S,null,C(n.value,p=>(l(),i("label",{key:p.id,class:"flex items-center gap-2 p-2 text-gray-300 rounded-md cursor-pointer hover:bg-black-300"},[f("input",{type:"checkbox",class:"w-4 h-4 text-[#ff5e65] border-gray-300 rounded focus:ring-[#ff5e65]",value:p.id,checked:u(p.id),onChange:k=>o(p.id)},null,40,Ce),E(" "+F(p.name),1)]))),128))]))}}),Be={key:0},Ie=V({__name:"FiltersPanelControl",props:{prop:{},name:{},type:{},options:{},values:{}},emits:["close","update:values"],setup(e){return(a,t)=>e.type==="multi-select"?(l(),i("div",Be,[$(qe,{options:e.options,values:e.values,"onUpdate:values":t[0]||(t[0]=m=>a.$emit("update:values",{prop:e.prop,value:m}))},null,8,["options","values"])])):b("",!0)}}),Le={class:"h-dvh md:border-l-2 border-black-300 md:w-80 flex-shrink-0 xl:w-[30rem] flex flex-col absolute inset-0 md:relative bg-black-400 z-50"},je={class:"flex items-center w-full h-[69px] border-b-2 border-black-300 px-4 sticky top-0 text-black-100"},Ae={class:"h-[calc(100vh-69px)] py-4 pt-0 overflow-x-hidden"},Ee=["onClick"],Me={class:"text-sm font-normal text-black-100"},Oe=V({__name:"FiltersPanel",props:{filters:{},filtersValues:{}},emits:["close","set-filters","remove-filters"],setup(e){const a=g({});return(t,m)=>(l(),i("div",Le,[f("div",je,[f("button",{class:"ml-auto disabled:cursor-wait",onClick:m[0]||(m[0]=s=>t.$emit("close"))},[$(d(R),{class:"w-6 h-6 text-white"})])]),f("div",Ae,[f("div",null,[(l(!0),i(S,null,C(e.filters,s=>(l(),i("div",{key:s.prop},[f("button",{class:"sticky top-0 flex items-center justify-between w-full p-4 font-semibold text-gray-100 border-b-2 border-black-300 bg-black-400",onClick:n=>a.value[s.prop]=!a.value[s.prop]},[f("div",null,[E(F(s.name)+" ",1),f("span",Me,"("+F(e.filtersValues[s.prop]?.length?`${e.filtersValues[s.prop].length}/${s.options.length}`:s.options.length)+")",1)]),$(d(te),{class:A(["w-6 h-6 duration-300 text-black-200",{"rotate-180":a.value[s.prop]}])},null,8,["class"])],8,Ee),a.value[s.prop]?(l(),i("div",{key:0,class:A(["p-4",{"border-b-2 border-black-300":a.value}])},[$(Ie,{prop:s.prop,name:s.name,type:s.type,options:s.options,values:e.filtersValues[s.prop]??[],"onUpdate:values":m[1]||(m[1]=n=>t.$emit("set-filters",n))},null,8,["prop","name","type","options","values"])],2)):b("",!0)]))),128))])])]))}}),ze=({query:e})=>a=>K(`list/${a}`,()=>{const t=Z(),m=G(),s=g(!1),n=g(""),o=g(1),u=g([]),c=g([]),r=g(0),p=g([]),k=g({});async function q(){O(),s.value=!0,o.value=1;try{const{items:v,filters:y}=await e({search:n.value,filters:k.value});u.value=v,r.value=u.value.length,c.value=u.value.slice((o.value-1)*20,o.value*20),p.value=y??[]}catch(v){console.error(v instanceof Error?v.message:"An unknown error occurred")}finally{s.value=!1}}async function M(){o.value+=1,c.value.push(...u.value.slice((o.value-1)*20,o.value*20))}function j(v){O(),n.value=v,q(),I()}function w({prop:v,value:y}){y.length===0?delete k.value[v]:k.value[v]=y,I()}function B(){k.value={},I()}function O(){c.value=[],u.value=[],r.value=0}function I(){const v={};Object.entries(t.query).forEach(([y,h])=>{h!=null&&(Array.isArray(h)?v[y]=h.filter(T=>T!==null):typeof h=="string"&&(v[y]=h))}),n.value.length?v.q=n.value:delete v.q,Object.entries(k.value).forEach(([y,h])=>{h.length?v[y]=h:delete v[y]}),m.push({query:v})}return H(()=>{k.value={},n.value="";const v=typeof t.query.q=="string"?t.query.q:"";n.value=v,Object.entries(t.query).forEach(([y,h])=>{y!=="q"&&y!=="itemId"&&h&&(typeof h=="string"?k.value[y]=h.includes(",")?h.split(","):[h]:Array.isArray(h)&&(k.value[y]=h))}),q()}),J(()=>{W()?._s?.forEach(v=>{v.$id===`list/${a}`&&(v.$dispose(),j(""))}),m.push({query:{}})}),{items:c,itemsCount:r,search:n,loading:s,filters:p,filtersValues:k,fetch:q,loadMore:M,setSearch:j,setFilters:w,removeFilters:B}});function De(e){const{query:a,storeId:t,title:m,filterTransform:s}=e,n=X(),o=ze({query:a})(t)(),u=g(!1),c=x(()=>s?s(o.filters):o.filters);function r(){n.deleteItem(),u.value=!0}function p(){u.value=!1}function k(w){u.value=!1,n.getItemDetails(w)}function q({prop:w,value:B}){o.setFilters({prop:w,value:B}),o.fetch()}function M(){o.removeFilters(),o.fetch()}function j({prop:w,value:B}){const I=(o.filtersValues[w]??[]).filter(v=>v!==B);o.setFilters({prop:w,value:I}),o.fetch()}return ee(m),{items:x(()=>o.items),itemsCount:x(()=>o.itemsCount),loading:x(()=>o.loading),search:x(()=>o.search),filters:c,filtersValues:x(()=>o.filtersValues),hasFilters:x(()=>c.value.length>0),hasSelectedFilters:x(()=>Object.keys(o.filtersValues).length>0),showFilters:u,setSearch:o.setSearch,loadMore:o.loadMore,openFilters:r,closeFilters:p,selectItem:k,setFilters:q,removeFilters:M,removeFilter:j}}const Re={class:"flex flex-row flex-1"},Pe=V({__name:"BaseItemListView",props:{query:{},storeId:{},title:{},filterTransform:{type:Function,default:void 0},isVideo:{type:Boolean,default:!1}},setup(e){const a=e,t=De({query:a.query,storeId:a.storeId,title:a.title,filterTransform:a.filterTransform});return(m,s)=>(l(),i("div",Re,[$(Se,{items:d(t).items.value,"items-count":d(t).itemsCount.value,loading:d(t).loading.value,search:d(t).search.value,"has-filters":d(t).hasFilters.value,"has-selected-filters":d(t).hasSelectedFilters.value,filters:d(t).filters.value,"filters-values":d(t).filtersValues.value,"is-video":e.isVideo,onSetQuery:s[0]||(s[0]=n=>d(t).setSearch(n)),onSelect:d(t).selectItem,onLoadMore:s[1]||(s[1]=n=>d(t).loadMore()),onOpenFilters:s[2]||(s[2]=n=>d(t).openFilters()),onRemoveFilter:d(t).removeFilter},null,8,["items","items-count","loading","search","has-filters","has-selected-filters","filters","filters-values","is-video","onSelect","onRemoveFilter"]),d(t).showFilters.value?(l(),L(Oe,{key:0,filters:d(t).filters.value,"filters-values":d(t).filtersValues.value,onSetFilters:d(t).setFilters,onRemoveFilters:d(t).removeFilters,onClose:s[3]||(s[3]=n=>d(t).closeFilters())},null,8,["filters","filters-values","onSetFilters","onRemoveFilters"])):b("",!0)]))}});export{Pe as _};
