import{a as l,b as m,o as n,d as B,e as V,_ as Ce,g as ae,R as Me,J as $e,F as $,r as S,A as Se,t as L,l as M,K as W,L as g,u as Te,j as w,c as R,w as De,M as q,z as Z,x as Re,i as _e,s as Ie,v as Ee}from"./index-BALl6K1o.js";import{S as Fe}from"./SkinService-CSpV3fMK.js";import{S as Ve}from"./StickersService-BgdEUnjJ.js";import{u as Le}from"./useTitle-CQtUyMpN.js";function Ne(s,r){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}class Xe{skinService=new Fe;stickersService=new Ve;async loadKnives(){const r=new Set;return this.skinService.query({search:"",filters:{category:["sfui_invpanel_filter_melee"]}}).then(e=>(e.items=e.items.filter(a=>r.has(a.skin_id)?!1:(r.add(a.skin_id),!0)),e.items))}async loadTeamStickers(){return this.stickersService.query({search:"",filters:{}}).then(r=>r.items.filter(e=>e.tournament&&e.team&&!e.player))}async loadPlayerStickers(){return this.stickersService.query({search:"",filters:{}}).then(r=>r.items.filter(e=>e.tournament&&e.player))}async loadAllTabsData(){const[r,e,a]=await Promise.all([this.loadKnives(),this.loadTeamStickers(),this.loadPlayerStickers()]),o=[],v=this.processKnives(r);o.push({id:"knives",name:"Knives",showCrates:!0,showOnlyFirstItem:!1,...v});const y=this.processTeamStickers(e);o.push({id:"team-stickers",name:"Team Stickers",showCrates:!1,showOnlyFirstItem:!0,...y});const h=this.processPlayerStickers(a);return o.push({id:"player-stickers",name:"Player Stickers",showCrates:!1,showOnlyFirstItem:!0,...h}),o}processMatrix(r,e){const a=new Set,o=new Map;for(const c of r){const d=e.getColumnValue(c);a.add(d);const f=e.getRowKey(c);o.has(f)||o.set(f,e.getRowItem(c))}const v=Array.from(a).sort(),y=new Map;for(const c of r){const d=e.getColumnValue(c),p=`${e.getRowKey(c)}|${d}`;y.has(p)||y.set(p,{items:[],...e.includeCrates?{crates:[]}:{}});const b=y.get(p);if(b.items.push({id:c.id,name:c.name,image:c.image}),e.includeCrates){const U=e.includeCrates(c);U&&b.crates.push(...U)}}const h=new Map;for(const c of r){const d=e.getRowKey(c),f=e.getColumnValue(c);h.has(d)||h.set(d,new Set),h.get(d).add(f)}const k=v.length,T=new Map,D=Array.from(o.entries()).map(([c,d])=>{const f=String(e.getRowDisplay(d,c)||""),p=h.get(c)?.size||0,b=e.showCountInDisplay?`${f} (${p}/${k})`:f;return T.set(c,b),{key:c,display:f,count:p}}).sort((c,d)=>e.customSort?e.customSort(c,d):d.count!==c.count?d.count-c.count:String(c.display).localeCompare(String(d.display))).map(c=>c.key);return{columns:v,rows:D,rowDisplayMap:T,matrixMap:y}}processTeamStickers(r){return this.processMatrix(r,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.team.name,getRowDisplay:e=>e.team.name,getRowItem:e=>e,showCountInDisplay:!0})}processPlayerStickers(r){return this.processMatrix(r,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.player.name,getRowDisplay:e=>e.player.name,getRowItem:e=>e,showCountInDisplay:!0})}processKnives(r){return this.processMatrix(r,{getColumnValue:e=>e.weapon?.name||"Unknown",getRowKey:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowDisplay:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowItem:e=>e,includeCrates:e=>e.crates,customSort:(e,a)=>e.key==="Vanilla"?-1:a.key==="Vanilla"?1:a.count!==e.count?a.count-e.count:e.display.localeCompare(a.display)})}}const Ae={class:"flex items-center justify-between border-black-300 border-b-2 h-[69px] px-4"},Ke={class:"flex items-center gap-2"},Oe=B({__name:"MatrixHeader",setup(s){return(r,e)=>(n(),l("div",Ae,[V(Ce),m("div",Ke,[V(ae(Me),{to:"/home",class:"flex items-center gap-2 px-3 py-2 rounded-md text-black-100 hover:bg-black-300 hover:text-white transition-colors"},{default:$e(()=>[V(ae(Ne),{class:"w-5 h-5"}),e[0]||(e[0]=m("span",{class:"text-sm font-medium"},"Back to Home",-1))]),_:1})])]))}}),We={class:"inline-flex px-4 py-2 p-1 gap-0 w-full border-b-2 border-black-300"},Be=["onClick"],Ue=B({__name:"MatrixTabs",props:{tabs:{},selectedTabId:{}},emits:["select-tab"],setup(s){return(r,e)=>(n(),l("div",We,[(n(!0),l($,null,S(s.tabs,(a,o)=>(n(),l("button",{key:a.id,class:Se(["px-4 py-2 text-sm font-medium transition-all",s.selectedTabId===a.id?"bg-black-300 text-white rounded shadow-sm":o===0?"bg-black-400 text-black-100 rounded-l":o===s.tabs.length-1?"bg-black-400 text-black-100 rounded-r":"bg-black-400 text-black-100"]),onClick:v=>r.$emit("select-tab",a.id)},L(a.name),11,Be))),128))]))}}),ze={key:0,class:"flex flex-col gap-2 items-center justify-center h-full"},He={class:"flex flex-wrap gap-1 justify-center"},je=["src","alt"],qe={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Pe=["onClick"],Ge=["src","alt"],Je={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Qe={key:0,class:"flex flex-wrap gap-1 justify-center"},Ye=["onClick"],Ze=["src","alt"],et={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30"},tt={key:1,class:"text-black-300 text-xs"},at=B({__name:"MatrixCell",props:{cellData:{},row:{},column:{},showOnlyFirstItem:{type:Boolean},showCrates:{type:Boolean}},emits:["select-item","select-crate"],setup(s){function r(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/62fx62fdpx2x"}function e(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/32fx32fdpx2x"}return(a,o)=>s.cellData?(n(),l("div",ze,[m("div",He,[s.showOnlyFirstItem?(n(),l($,{key:0},[s.cellData.items.length>0?(n(),l("button",{key:`${s.row}-${s.column}-${s.cellData.items[0].id}`,class:"group relative flex flex-col items-center",onClick:o[1]||(o[1]=v=>a.$emit("select-item",s.cellData.items[0].id))},[m("img",{src:r(s.cellData.items[0].image),alt:s.cellData.items[0].name,draggable:"false",class:"w-24 h-24 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:o[0]||(o[0]=W(()=>{},["prevent"]))},null,40,je),m("div",qe,L(s.cellData.items[0].name),1)])):M("",!0)],64)):(n(!0),l($,{key:1},S(s.cellData.items,v=>(n(),l("button",{key:`${s.row}-${s.column}-${v.id}`,class:"group relative flex flex-col items-center",onClick:y=>a.$emit("select-item",v.id)},[m("img",{src:r(v.image),alt:v.name,draggable:"false",class:"w-16 h-16 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:o[2]||(o[2]=W(()=>{},["prevent"]))},null,40,Ge),m("div",Je,L(v.name),1)],8,Pe))),128))]),s.showCrates&&s.cellData.crates?(n(),l("div",Qe,[(n(!0),l($,null,S(s.cellData.crates,v=>(n(),l("button",{key:`${s.row}-${s.column}-crate-${v.id}`,class:"group relative",onClick:W(y=>a.$emit("select-crate",v.id),["stop"])},[m("img",{src:e(v.image),alt:v.name,draggable:"false",class:"w-8 h-8 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:o[3]||(o[3]=W(()=>{},["prevent"]))},null,40,Ze),m("div",et,L(v.name),1)],8,Ye))),128))])):M("",!0)])):(n(),l("span",tt,"â€”"))}}),nt={class:"sticky top-0 z-10 bg-black-400",style:{"box-shadow":"0 2px 0 #212121"}},st={class:"text-xs text-black-100 break-words"},ne=180,lt=B({__name:"MatrixTableHeader",props:{visibleColumns:{},visibleColStart:{},visibleColEnd:{},totalColumns:{}},setup(s){return(r,e)=>(n(),l("thead",nt,[m("tr",null,[e[0]||(e[0]=m("th",{class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px]"},null,-1)),s.visibleColStart>0?(n(),l("th",{key:0,style:g({width:`${s.visibleColStart*ne}px`})},null,4)):M("",!0),(n(!0),l($,null,S(s.visibleColumns,a=>(n(),l("th",{key:a,class:"border-r border-black-300 px-3 py-2 w-[180px] text-center"},[m("span",st,L(a),1)]))),128)),s.visibleColEnd<s.totalColumns-1?(n(),l("th",{key:1,style:g({width:`${(s.totalColumns-s.visibleColEnd-1)*ne}px`})},null,4)):M("",!0)])]))}}),rt={class:"flex flex-col flex-1 h-full min-w-0"},ot={class:"flex-shrink-0"},it={key:0,class:"flex-1 flex items-center justify-center"},ct={class:"border-collapse"},ut={class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px] h-[120px] align-middle"},mt={class:"text-sm text-white break-words"},F=120,_=180,O=250,se=3,le=2,ft=B({__name:"MatrixView",setup(s){const r=Te(),e=Ie(),a=Ee(),o=w(),v=w(),y=w(!0),h=w(0),k=w(!1),T=w(0),N=w(0),D=w([]);function c(){const t=e.query.tab;return t&&D.value.some(i=>i.id===t)?t:D.value[0]?.id||""}const d=w(""),f=R(()=>D.value.find(t=>t.id===d.value)),p=R(()=>f.value?.columns||[]),b=R(()=>f.value?.rows||[]),U=R(()=>f.value?.rowDisplayMap||new Map),re=R(()=>f.value?.matrixMap||new Map),oe=new Xe,ie=w(0),z=w(0),H=w(0),X=w(0),A=w(0),ce=R(()=>b.value.slice(z.value,H.value+1)),ee=R(()=>p.value.slice(X.value,A.value+1));function I(){if(!o.value||b.value.length===0||p.value.length===0)return;const t=o.value,i=t.clientHeight,u=t.clientWidth,x=t.scrollTop,K=Math.max(0,Math.floor(x/F)-se),xe=Math.min(b.value.length-1,Math.ceil((x+i)/F)+se),te=-h.value,be=te+u,ge=Math.max(0,Math.floor((te-O)/_)-le),ke=Math.min(p.value.length-1,Math.ceil((be-O)/_)+le);z.value=K,H.value=xe,X.value=ge,A.value=ke}function ue(){o.value&&(ie.value=o.value.scrollTop,I())}async function me(){y.value=!0;try{D.value=await oe.loadAllTabsData(),d.value===""&&(d.value=c()),q(()=>{I()})}catch(t){console.error("Error loading special items:",t)}finally{y.value=!1}}function de(t,i){const u=`${t}|${i}`;return re.value.get(u)||null}function ve(t){return U.value.get(t)||t}function he(t){r.getItemDetails(t)}function pe(t){if(t.startsWith("skin-vanilla")){r.getItemDetails(t);return}const i=t.includes("skin")?`${t}_0`:t;r.getItemDetails(i)}function fe(t){if(t.button!==0)return;const i=t.target;i.tagName==="BUTTON"||i.tagName==="IMG"||i.closest("button")||(k.value=!0,T.value=t.clientX,N.value=h.value,t.preventDefault(),document.addEventListener("mousemove",P),document.addEventListener("mouseup",G))}let C=null;function j(){if(!o.value||p.value.length===0)return 0;const t=O+p.value.length*_,i=o.value.clientWidth;if(t<=i)return 0;const u=-(t-i);return Math.round(u)}function P(t){k.value&&(C!==null&&cancelAnimationFrame(C),C=requestAnimationFrame(()=>{const i=t.clientX-T.value,u=0,x=j(),K=Math.max(Math.min(N.value+i,u),x);h.value=Math.round(K),C=null}),t.preventDefault())}function G(){k.value=!1,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",G)}function we(t){if(t.touches.length!==1)return;const i=t.target;i.tagName==="BUTTON"||i.tagName==="IMG"||i.closest("button")||(k.value=!0,T.value=t.touches[0].clientX,N.value=h.value,t.preventDefault(),document.addEventListener("touchmove",J,{passive:!1}),document.addEventListener("touchend",Q))}function J(t){!k.value||t.touches.length!==1||(C!==null&&cancelAnimationFrame(C),C=requestAnimationFrame(()=>{const i=t.touches[0].clientX-T.value,u=0,x=j(),K=Math.max(Math.min(N.value+i,u),x);h.value=Math.round(K),C=null}),t.preventDefault())}function Q(){k.value=!1,document.removeEventListener("touchmove",J),document.removeEventListener("touchend",Q)}let E=null;const ye=t=>{t.preventDefault(),t.stopPropagation(),E!==null&&cancelAnimationFrame(E),E=requestAnimationFrame(()=>{const u=j(),x=Math.max(Math.min(h.value-t.deltaX,0),u);h.value=Math.round(x),E=null})};function Y(){const i=j(),u=Math.max(Math.min(h.value,0),i);h.value=Math.round(u)}return De(async()=>{await me(),await q(),Y(),I()}),Z([p,b],async()=>{await q(),Y(),I()}),Z(h,()=>{I()}),Z(d,t=>{a.replace({query:{...e.query,tab:t}}),h.value=0,o.value&&(o.value.scrollTop=0),q(()=>{Y(),I()})}),Re(()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",G),document.removeEventListener("touchmove",J),document.removeEventListener("touchend",Q),C!==null&&cancelAnimationFrame(C),E!==null&&cancelAnimationFrame(E)}),Le("Matrix - Counter-Strike items"),(t,i)=>(n(),l("div",rt,[m("div",ot,[V(Oe),y.value?M("",!0):(n(),_e(Ue,{key:0,tabs:D.value,"selected-tab-id":d.value,onSelectTab:i[0]||(i[0]=u=>d.value=u)},null,8,["tabs","selected-tab-id"]))]),y.value?(n(),l("div",it,[...i[1]||(i[1]=[m("svg",{class:"size-8 animate-spin text-white/10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[m("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),m("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(n(),l("div",{key:1,ref_key:"containerRef",ref:o,class:"flex-1 overflow-y-scroll overflow-x-hidden relative min-w-0 max-w-full",style:{height:"0"},onWheel:W(ye,["shift"]),onMousedown:fe,onTouchstart:we,onScroll:ue},[m("div",{ref_key:"matrixRef",ref:v,class:"select-none",style:g({minWidth:"max-content",transform:`translateX(${h.value}px)`,transition:k.value?"none":"transform 0.1s ease-out",cursor:k.value?"grabbing":"grab"})},[m("table",ct,[V(lt,{"visible-columns":ee.value,"visible-col-start":X.value,"visible-col-end":A.value,"total-columns":p.value.length},null,8,["visible-columns","visible-col-start","visible-col-end","total-columns"]),m("tbody",null,[z.value>0?(n(),l("tr",{key:0,style:g({height:`${z.value*F}px`})},[m("td",{style:g({width:`${O}px`})},null,4),(n(!0),l($,null,S(p.value,u=>(n(),l("td",{key:`spacer-${u}`,style:g({width:`${_}px`})},null,4))),128))],4)):M("",!0),(n(!0),l($,null,S(ce.value,u=>(n(),l("tr",{key:u,class:"hover:bg-black-300/20 border-b border-black-300/30"},[m("td",ut,[m("span",mt,L(ve(u)),1)]),X.value>0?(n(),l("td",{key:0,style:g({width:`${X.value*_}px`,height:`${F}px`})},null,4)):M("",!0),(n(!0),l($,null,S(ee.value,x=>(n(),l("td",{key:`${u}-${x}`,class:"border-r border-black-300/50 px-2 py-2 w-[180px] h-[120px] align-middle text-center"},[V(at,{"cell-data":de(u,x),row:u,column:x,"show-only-first-item":f.value?.showOnlyFirstItem,"show-crates":f.value?.showCrates,onSelectItem:pe,onSelectCrate:he},null,8,["cell-data","row","column","show-only-first-item","show-crates"])]))),128)),A.value<p.value.length-1?(n(),l("td",{key:1,style:g({width:`${(p.value.length-A.value-1)*_}px`,height:`${F}px`})},null,4)):M("",!0)]))),128)),H.value<b.value.length-1?(n(),l("tr",{key:1,style:g({height:`${(b.value.length-H.value-1)*F}px`})},[m("td",{style:g({width:`${O}px`})},null,4),(n(!0),l($,null,S(p.value,u=>(n(),l("td",{key:`spacer-bottom-${u}`,style:g({width:`${_}px`})},null,4))),128))],4)):M("",!0)])])],4)],544))]))}});export{ft as default};
