import{a as l,b as u,o as s,d as A,e as E,_ as be,g as ee,W as ge,Q as ke,F as C,r as $,N as Ce,t as F,l as k,X as O,Y as b,u as $e,j as y,c as D,y as Se,K as z,J as Q,z as Me,i as De,w as Te,x as Re}from"./index-COoWOHso.js";import{S as _e}from"./SkinService-BsLi-5h1.js";import{S as Ie}from"./StickersService-CSG16jCU.js";import{u as Ve}from"./useTitle-gXi2KnXJ.js";function Ee(n,r){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}class Fe{skinService=new _e;stickersService=new Ie;async loadKnives(){const r=new Set;return this.skinService.query({search:"",filters:{category:["sfui_invpanel_filter_melee"]}}).then(e=>(e.items=e.items.filter(a=>r.has(a.skin_id)?!1:(r.add(a.skin_id),!0)),e.items))}async loadTeamStickers(){return this.stickersService.query({search:"",filters:{}}).then(r=>r.items.filter(e=>e.tournament&&e.team&&!e.player))}async loadPlayerStickers(){return this.stickersService.query({search:"",filters:{}}).then(r=>r.items.filter(e=>e.tournament&&e.player))}async loadAllTabsData(){const[r,e,a]=await Promise.all([this.loadKnives(),this.loadTeamStickers(),this.loadPlayerStickers()]),o=[],v=this.processKnives(r);o.push({id:"knives",name:"Knives",showCrates:!0,showOnlyFirstItem:!1,...v});const w=this.processTeamStickers(e);o.push({id:"team-stickers",name:"Team Stickers",showCrates:!1,showOnlyFirstItem:!0,...w});const p=this.processPlayerStickers(a);return o.push({id:"player-stickers",name:"Player Stickers",showCrates:!1,showOnlyFirstItem:!0,...p}),o}processMatrix(r,e){const a=new Set,o=new Map;for(const i of r){const d=e.getColumnValue(i);a.add(d);const f=e.getRowKey(i);o.has(f)||o.set(f,e.getRowItem(i))}const v=Array.from(a).sort(),w=new Map;for(const i of r){const d=e.getColumnValue(i),h=`${e.getRowKey(i)}|${d}`;w.has(h)||w.set(h,{items:[],...e.includeCrates?{crates:[]}:{}});const x=w.get(h);if(x.items.push({id:i.id,name:i.name,image:i.image}),e.includeCrates){const B=e.includeCrates(i);B&&x.crates.push(...B)}}const p=new Map;for(const i of r){const d=e.getRowKey(i),f=e.getColumnValue(i);p.has(d)||p.set(d,new Set),p.get(d).add(f)}const S=v.length,K=new Map,M=Array.from(o.entries()).map(([i,d])=>{const f=String(e.getRowDisplay(d,i)||""),h=p.get(i)?.size||0,x=e.showCountInDisplay?`${f} (${h}/${S})`:f;return K.set(i,x),{key:i,display:f,count:h}}).sort((i,d)=>e.customSort?e.customSort(i,d):d.count!==i.count?d.count-i.count:String(i.display).localeCompare(String(d.display))).map(i=>i.key);return{columns:v,rows:M,rowDisplayMap:K,matrixMap:w}}processTeamStickers(r){return this.processMatrix(r,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.team.name,getRowDisplay:e=>e.team.name,getRowItem:e=>e,showCountInDisplay:!0})}processPlayerStickers(r){return this.processMatrix(r,{getColumnValue:e=>e.tournament.name,getRowKey:e=>e.player.name,getRowDisplay:e=>e.player.name,getRowItem:e=>e,showCountInDisplay:!0})}processKnives(r){return this.processMatrix(r,{getColumnValue:e=>e.weapon?.name||"Unknown",getRowKey:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowDisplay:e=>{const a=e.pattern?.name||"Vanilla";return e.phase?`${a} (${e.phase})`:a},getRowItem:e=>e,includeCrates:e=>e.crates,customSort:(e,a)=>e.key==="Vanilla"?-1:a.key==="Vanilla"?1:a.count!==e.count?a.count-e.count:e.display.localeCompare(a.display)})}}const Ke={class:"flex items-center justify-between border-black-300 border-b-2 h-[69px] px-4"},Ne={class:"flex items-center gap-2"},We=A({__name:"MatrixHeader",setup(n){return(r,e)=>(s(),l("div",Ke,[E(be),u("div",Ne,[E(ee(ge),{to:"/home",class:"flex items-center gap-2 px-3 py-2 rounded-md text-black-100 hover:bg-black-300 hover:text-white transition-colors"},{default:ke(()=>[E(ee(Ee),{class:"w-5 h-5"}),e[0]||(e[0]=u("span",{class:"text-sm font-medium"},"Back to Home",-1))]),_:1})])]))}}),Xe={class:"inline-flex px-4 py-2 p-1 gap-0 w-full border-b-2 border-black-300"},Oe=["onClick"],Ae=A({__name:"MatrixTabs",props:{tabs:{},selectedTabId:{}},emits:["select-tab"],setup(n){return(r,e)=>(s(),l("div",Xe,[(s(!0),l(C,null,$(n.tabs,(a,o)=>(s(),l("button",{key:a.id,class:Ce(["px-4 py-2 text-sm font-medium transition-all",n.selectedTabId===a.id?"bg-black-300 text-white rounded shadow-sm":o===0?"bg-black-400 text-black-100 rounded-l":o===n.tabs.length-1?"bg-black-400 text-black-100 rounded-r":"bg-black-400 text-black-100"]),onClick:v=>r.$emit("select-tab",a.id)},F(a.name),11,Oe))),128))]))}}),Be={key:0,class:"flex flex-col gap-2 items-center justify-center h-full"},Le={class:"flex flex-wrap gap-1 justify-center"},Ue=["src","alt"],ze={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},He=["onClick"],je=["src","alt"],qe={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30 max-w-[200px] text-center"},Pe={key:0,class:"flex flex-wrap gap-1 justify-center"},Ge=["onClick"],Je=["src","alt"],Qe={class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-30"},Ye={key:1,class:"text-black-300 text-xs"},Ze=A({__name:"MatrixCell",props:{cellData:{},row:{},column:{},showOnlyFirstItem:{type:Boolean},showCrates:{type:Boolean}},emits:["select-item","select-crate"],setup(n){function r(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/62fx62fdpx2x"}function e(a){return a?.includes("cdn.steamstatic")||a?.includes("raw.githubusercontent")?a:a+"/32fx32fdpx2x"}return(a,o)=>n.cellData?(s(),l("div",Be,[u("div",Le,[n.showOnlyFirstItem?(s(),l(C,{key:0},[n.cellData.items.length>0?(s(),l("button",{key:`${n.row}-${n.column}-${n.cellData.items[0].id}`,class:"group relative flex flex-col items-center",onClick:o[1]||(o[1]=v=>a.$emit("select-item",n.cellData.items[0].id))},[u("img",{src:r(n.cellData.items[0].image),alt:n.cellData.items[0].name,draggable:"false",class:"w-24 h-24 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:o[0]||(o[0]=O(()=>{},["prevent"]))},null,40,Ue),u("div",ze,F(n.cellData.items[0].name),1)])):k("",!0)],64)):(s(!0),l(C,{key:1},$(n.cellData.items,v=>(s(),l("button",{key:`${n.row}-${n.column}-${v.id}`,class:"group relative flex flex-col items-center",onClick:w=>a.$emit("select-item",v.id)},[u("img",{src:r(v.image),alt:v.name,draggable:"false",class:"w-16 h-16 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:o[2]||(o[2]=O(()=>{},["prevent"]))},null,40,je),u("div",qe,F(v.name),1)],8,He))),128))]),n.showCrates&&n.cellData.crates?(s(),l("div",Pe,[(s(!0),l(C,null,$(n.cellData.crates,v=>(s(),l("button",{key:`${n.row}-${n.column}-crate-${v.id}`,class:"group relative",onClick:O(w=>a.$emit("select-crate",v.id),["stop"])},[u("img",{src:e(v.image),alt:v.name,draggable:"false",class:"w-8 h-8 object-contain rounded hover:opacity-80 transition-opacity select-none",onDragstart:o[3]||(o[3]=O(()=>{},["prevent"]))},null,40,Je),u("div",Qe,F(v.name),1)],8,Ge))),128))])):k("",!0)])):(s(),l("span",Ye,"â€”"))}}),et={class:"sticky top-0 z-10 bg-black-400",style:{"box-shadow":"0 2px 0 #212121"}},tt={class:"text-xs text-black-100 break-words"},te=180,at=A({__name:"MatrixTableHeader",props:{visibleColumns:{},visibleColStart:{},visibleColEnd:{},totalColumns:{}},setup(n){return(r,e)=>(s(),l("thead",et,[u("tr",null,[e[0]||(e[0]=u("th",{class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px]"},null,-1)),n.visibleColStart>0?(s(),l("th",{key:0,style:b({width:`${n.visibleColStart*te}px`})},null,4)):k("",!0),(s(!0),l(C,null,$(n.visibleColumns,a=>(s(),l("th",{key:a,class:"border-r border-black-300 px-3 py-2 w-[180px] text-center"},[u("span",tt,F(a),1)]))),128)),n.visibleColEnd<n.totalColumns-1?(s(),l("th",{key:1,style:b({width:`${(n.totalColumns-n.visibleColEnd-1)*te}px`})},null,4)):k("",!0)])]))}}),st={class:"flex flex-col flex-1 h-full min-w-0"},nt={class:"flex-shrink-0"},lt={key:0,class:"flex-1 flex items-center justify-center"},rt={class:"border-collapse"},ot={class:"bg-black-400 border-r-2 border-black-300 px-3 py-2 w-[250px] h-[120px] align-middle"},it={class:"text-sm text-white break-words"},V=120,T=180,X=250,ae=3,se=2,vt=A({__name:"SpecialItemsMatrixView",setup(n){const r=$e(),e=Te(),a=Re(),o=y(),v=y(),w=y(!0),p=y(0),S=y(!1),K=y(0),H=y(0),M=y([]);function i(){const t=e.query.tab;return t&&M.value.some(c=>c.id===t)?t:M.value[0]?.id||""}const d=y(""),f=D(()=>M.value.find(t=>t.id===d.value)),h=D(()=>f.value?.columns||[]),x=D(()=>f.value?.rows||[]),B=D(()=>f.value?.rowDisplayMap||new Map),ne=D(()=>f.value?.matrixMap||new Map),le=new Fe,re=y(0),L=y(0),U=y(0),N=y(0),W=y(0),oe=D(()=>x.value.slice(L.value,U.value+1)),Y=D(()=>h.value.slice(N.value,W.value+1));function R(){if(!o.value||x.value.length===0||h.value.length===0)return;const t=o.value,c=t.clientHeight,m=t.clientWidth,g=t.scrollTop,J=Math.max(0,Math.floor(g/V)-ae),fe=Math.min(x.value.length-1,Math.ceil((g+c)/V)+ae),Z=-p.value,ye=Z+m,we=Math.max(0,Math.floor((Z-X)/T)-se),xe=Math.min(h.value.length-1,Math.ceil((ye-X)/T)+se);L.value=J,U.value=fe,N.value=we,W.value=xe}function ie(){o.value&&(re.value=o.value.scrollTop,R())}async function ce(){w.value=!0;try{M.value=await le.loadAllTabsData(),d.value===""&&(d.value=i()),z(()=>{R()})}catch(t){console.error("Error loading special items:",t)}finally{w.value=!1}}function ue(t,c){const m=`${t}|${c}`;return ne.value.get(m)||null}function me(t){return B.value.get(t)||t}function de(t){r.getItemDetails(t)}function ve(t){if(t.startsWith("skin-vanilla")){r.getItemDetails(t);return}const c=t.includes("skin")?`${t}_0`:t;r.getItemDetails(c)}function he(t){if(t.button!==0)return;const c=t.target;c.tagName==="BUTTON"||c.tagName==="IMG"||c.closest("button")||(S.value=!0,K.value=t.clientX,H.value=p.value,t.preventDefault(),document.addEventListener("mousemove",q),document.addEventListener("mouseup",P))}let _=null;function j(){if(!o.value||h.value.length===0)return 0;const t=X+h.value.length*T,c=o.value.clientWidth;if(t<=c)return 0;const m=-(t-c);return Math.round(m)}function q(t){S.value&&(_!==null&&cancelAnimationFrame(_),_=requestAnimationFrame(()=>{const c=t.clientX-K.value,m=0,g=j(),J=Math.max(Math.min(H.value+c,m),g);p.value=Math.round(J),_=null}),t.preventDefault())}function P(){S.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",P)}let I=null;const pe=t=>{t.preventDefault(),t.stopPropagation(),I!==null&&cancelAnimationFrame(I),I=requestAnimationFrame(()=>{const m=j(),g=Math.max(Math.min(p.value-t.deltaX,0),m);p.value=Math.round(g),I=null})};function G(){const c=j(),m=Math.max(Math.min(p.value,0),c);p.value=Math.round(m)}return Se(async()=>{await ce(),await z(),G(),R()}),Q([h,x],async()=>{await z(),G(),R()}),Q(p,()=>{R()}),Q(d,t=>{a.replace({query:{...e.query,tab:t}}),p.value=0,o.value&&(o.value.scrollTop=0),z(()=>{G(),R()})}),Me(()=>{document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",P),_!==null&&cancelAnimationFrame(_),I!==null&&cancelAnimationFrame(I)}),Ve("Special Items Matrix - Counter-Strike items"),(t,c)=>(s(),l("div",st,[u("div",nt,[E(We),w.value?k("",!0):(s(),De(Ae,{key:0,tabs:M.value,"selected-tab-id":d.value,onSelectTab:c[0]||(c[0]=m=>d.value=m)},null,8,["tabs","selected-tab-id"]))]),w.value?(s(),l("div",lt,[...c[1]||(c[1]=[u("svg",{class:"size-8 animate-spin text-white/10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[u("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),u("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(s(),l("div",{key:1,ref_key:"containerRef",ref:o,class:"flex-1 overflow-y-scroll overflow-x-hidden relative min-w-0 max-w-full",style:{height:"0"},onWheel:O(pe,["shift"]),onMousedown:he,onScroll:ie},[u("div",{ref_key:"matrixRef",ref:v,class:"select-none",style:b({minWidth:"max-content",transform:`translateX(${p.value}px)`,transition:S.value?"none":"transform 0.1s ease-out",cursor:S.value?"grabbing":"grab"})},[u("table",rt,[E(at,{"visible-columns":Y.value,"visible-col-start":N.value,"visible-col-end":W.value,"total-columns":h.value.length},null,8,["visible-columns","visible-col-start","visible-col-end","total-columns"]),u("tbody",null,[L.value>0?(s(),l("tr",{key:0,style:b({height:`${L.value*V}px`})},[u("td",{style:b({width:`${X}px`})},null,4),(s(!0),l(C,null,$(h.value,m=>(s(),l("td",{key:`spacer-${m}`,style:b({width:`${T}px`})},null,4))),128))],4)):k("",!0),(s(!0),l(C,null,$(oe.value,m=>(s(),l("tr",{key:m,class:"hover:bg-black-300/20 border-b border-black-300/30"},[u("td",ot,[u("span",it,F(me(m)),1)]),N.value>0?(s(),l("td",{key:0,style:b({width:`${N.value*T}px`,height:`${V}px`})},null,4)):k("",!0),(s(!0),l(C,null,$(Y.value,g=>(s(),l("td",{key:`${m}-${g}`,class:"border-r border-black-300/50 px-2 py-2 w-[180px] h-[120px] align-middle text-center"},[E(Ze,{"cell-data":ue(m,g),row:m,column:g,"show-only-first-item":f.value?.showOnlyFirstItem,"show-crates":f.value?.showCrates,onSelectItem:ve,onSelectCrate:de},null,8,["cell-data","row","column","show-only-first-item","show-crates"])]))),128)),W.value<h.value.length-1?(s(),l("td",{key:1,style:b({width:`${(h.value.length-W.value-1)*T}px`,height:`${V}px`})},null,4)):k("",!0)]))),128)),U.value<x.value.length-1?(s(),l("tr",{key:1,style:b({height:`${(x.value.length-U.value-1)*V}px`})},[u("td",{style:b({width:`${X}px`})},null,4),(s(!0),l(C,null,$(h.value,m=>(s(),l("td",{key:`spacer-bottom-${m}`,style:b({width:`${T}px`})},null,4))),128))],4)):k("",!0)])])],4)],544))]))}});export{vt as default};
