import{a as se,v as ne}from"./vueuse-Cozvu0Dv.js";import{z as o,B as a,A as s,d as q,r as x,f as ae,H as z,G as y,Q as A,K as C,y as m,O as N,M as T,I,P as _,$ as U,a0 as re,F as P,J as j,c as $,o as J,L as oe,C as ie,D as ue,E as ce,b as de,a1 as fe}from"./vue-vendor-15Qh9fcm.js";import{g as ve,S as me,b as pe,M as he}from"./ui-vendor-DV6hXywW.js";import{r as X,a as W,u as be,b as ge}from"./index-CZ-aGPCB.js";import{u as ye}from"./useTitle-CEI1JtBK.js";function xe(e,d){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"})])}function ke(e,d){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function we(e,d){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}function $e(e,d){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const Fe={class:"relative"},Se={class:"absolute left-0 flex items-center h-full px-2"},Ve={class:"absolute right-0 flex items-center h-full gap-2 px-3"},Be={key:0,class:"px-2 text-sm text-white rounded-md bg-black-200 hidden sm:block"},Ce={class:"font-semibold"},Ie={key:1,class:"w-20 h-6 px-2 rounded-md bg-black-200 animate-pulse"},Me={key:2,class:"w-0.5 h-[calc(100%-20px)] rounded-full bg-black-200/20"},qe={key:0,class:"absolute top-1 right-1 bg-[#ff5e65] size-2 rounded-full"},Le=["onClick"],De={key:0,class:"absolute top-1 right-1 bg-[#ff5e65] size-2 rounded-full"},Pe={key:0,class:"flex gap-2 overflow-x-auto pb-0.5"},je={class:""},ze={class:"flex items-center gap-1 flex-wrap"},Ee=["onClick"],Ne=q({__name:"SearchBar",props:{query:{},total:{},scrolledDown:{type:Boolean},hasFilters:{type:Boolean},hasSelectedFilters:{type:Boolean},sortBy:{},loading:{type:Boolean},filters:{},filtersValues:{}},emits:["input","open-filters","remove-filter","set-sort-by"],setup(e,{emit:d}){const t=[{value:"",label:"Default"},{value:"price-asc",label:"Price: Low to High"},{value:"price-desc",label:"Price: High to Low"}],v=e,l=d,u=x(v.query||"");return ae(()=>v.query,r=>{u.value=r}),(r,c)=>(s(),o("div",{class:z(["sticky top-0 left-0 right-0 px-5 pt-3 pb-2 duration-300 z-10 gap-2 flex flex-col",[e.scrolledDown?"bg-black-300 shadow-lg":"bg-transparent"]])},[a("div",Fe,[a("div",Se,[C(m($e),{class:"w-6 h-6 text-black-200"})]),a("div",Ve,[e.loading?(s(),o("div",Ie)):(s(),o("p",Be,[c[3]||(c[3]=T(" total ",-1)),a("span",Ce,I(e.total),1)])),e.loading?y("",!0):(s(),o("div",Me)),e.loading?y("",!0):(s(),N(m(ve),{key:3,as:"div",class:"relative"},{default:_(()=>[C(m(me),{class:"p-1 rounded-md hover:bg-black-200 relative"},{default:_(()=>[C(m(xe),{class:"w-6 h-6 text-black-100"}),e.sortBy?(s(),o("div",qe)):y("",!0)]),_:1}),C(m(he),{class:"absolute right-0 top-full mt-2 w-44 rounded-lg border border-black-200/20 bg-black-400 shadow-xl z-20 p-1 focus:outline-none"},{default:_(()=>[(s(),o(P,null,j(t,i=>C(m(pe),{key:i.value},{default:_(({active:n})=>[a("button",{type:"button",class:z(["w-full text-left px-3 py-1.5 text-sm rounded-md",[e.sortBy===i.value?"text-[#ff5e65] font-medium":"text-gray-300",n?"bg-black-300":""]]),onClick:f=>l("set-sort-by",i.value)},I(i.label),11,Le)]),_:2},1024)),64))]),_:1})]),_:1})),e.hasFilters&&!e.loading?(s(),o("button",{key:4,type:"button",class:"p-1 rounded-md hover:bg-black-200 relative",onClick:c[0]||(c[0]=i=>r.$emit("open-filters"))},[C(m(we),{class:"w-6 h-6 text-black-100"}),e.hasSelectedFilters?(s(),o("div",De)):y("",!0)])):y("",!0)]),A(a("input",{"onUpdate:modelValue":c[1]||(c[1]=i=>u.value=i),class:"w-full h-full py-4 pl-12 pr-36 sm:pr-60 text-white border-0 rounded-md outline-none bg-black-300 focus:outline-none sm:text-sm focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent",type:"text",placeholder:"Search...",onKeyup:c[2]||(c[2]=re(i=>r.$emit("input",u.value),["enter"]))},null,544),[[U,u.value]])]),e.hasSelectedFilters?(s(),o("div",Pe,[(s(!0),o(P,null,j(e.filtersValues,(i,n)=>(s(),o("div",{key:n,class:"flex items-center gap-1 text-sm p-1 flex-shrink-0 text-white rounded-md bg-black-300"},[a("div",je,I(e.filters.find(f=>f.prop===n)?.name||n),1),a("div",ze,[(s(!0),o(P,null,j(i,f=>(s(),o("button",{key:f,type:"button",class:"text-white bg-black-200 px-1 rounded-md flex items-center gap-1",onClick:S=>r.$emit("remove-filter",{prop:n,value:f})},[C(m(X),{class:"size-4 text-white"}),T(" "+I(e.filters.find(S=>S.prop===n)?.options.find(S=>S.id===f)?.name||f),1)],8,Ee))),128))])]))),128))])):y("",!0)],2))}}),Oe={class:"flex flex-col"},Ae=["src","alt"],Re={class:"absolute flex flex-col items-end gap-1 top-2 right-2"},_e={key:0,class:"px-1.5 py-0.5 text-[10px] font-semibold leading-none tracking-wide rounded bg-[#ffd700]/90 text-gray-900"},Te={key:1,class:"px-1.5 py-0.5 text-[10px] font-semibold leading-none tracking-wide rounded bg-[#cf6a32]/90 text-white"},Ue={key:2,class:"px-1.5 py-0.5 text-[10px] font-semibold leading-none tracking-wide rounded bg-[#4d7455]/90 text-white"},He={key:3,class:"px-1.5 py-0.5 text-[10px] font-semibold leading-none tracking-wide rounded bg-[#5b98a8]/90 text-white"},Qe=["title"],Ke=q({__name:"ItemCard",props:{id:{},name:{},image:{},souvenir:{type:Boolean},stattrak:{type:Boolean},genuine:{type:Boolean},phase:{},marketHashName:{}},emits:["show"],setup(e){const d=e,{isDebugMode:t}=be(),v=W(),l=$(()=>v.getPrice(d.marketHashName)),u=$(()=>l.value?l.value:v.isMarketable(d.marketHashName)?"No price available":"Not marketable");return(r,c)=>(s(),o("div",Oe,[a("button",{type:"button",class:"relative block h-[12rem] p-1 overflow-hidden border-2 border-transparent rounded-md outline-none cursor-pointer focus:border-[#ff5e65] hover:border-[#ff5e65]",onClick:c[0]||(c[0]=i=>r.$emit("show"))},[a("img",{class:z(["object-contain w-full pointer-events-none h-full py-4 rounded-md bg-black-300/80 bg-[url('../img/graph-paper.svg')]",{"pb-0":e.id.includes("agent-"),"border-2 border-yellow-500":m(t)&&e.image.includes("githubusercontent")}]),src:e.image,alt:e.name,loading:"lazy"},null,10,Ae),a("div",Re,[e.souvenir?(s(),o("span",_e," Souvenir ")):y("",!0),e.stattrak?(s(),o("span",Te," StatTrak ")):y("",!0),e.genuine?(s(),o("span",Ue," Genuine ")):y("",!0),e.phase?(s(),o("span",He,I(e.phase),1)):y("",!0)])]),a("div",null,[a("p",{class:"text-sm truncate px-0.5 mt-1.5 text-white",title:e.name},I(e.name),9,Qe),a("p",{class:z(["text-xs px-0.5",l.value?"text-green-400":"text-black-100"])},I(u.value),3)])]))}}),Ge={class:"flex flex-col"},Ze=["src","alt"],Je={key:0,class:"absolute inset-0 bg-black-300 rounded-md animate-pulse"},Xe={key:1,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-20 rounded-md"},We=["src"],Ye=["title"],et=q({__name:"ItemVideo",props:{name:{},video:{},thumbnail:{}},emits:["show"],setup(e){const d=x(!1),t=x(!1);function v(){d.value=!0}return(l,u)=>(s(),o("div",Ge,[d.value?y("",!0):(s(),o("div",{key:0,class:"relative w-full aspect-video rounded-md cursor-pointer bg-gray-800",onClick:v},[a("img",{src:e.thumbnail,alt:e.name,class:"w-full h-full object-cover rounded-md",loading:"lazy",onLoad:u[0]||(u[0]=r=>t.value=!0),onError:u[1]||(u[1]=r=>t.value=!0)},null,40,Ze),t.value?y("",!0):(s(),o("div",Je)),t.value?(s(),o("div",Xe,[...u[2]||(u[2]=[a("div",{class:"w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all"},[a("svg",{class:"w-8 h-8 text-black ml-1",fill:"currentColor",viewBox:"0 0 24 24"},[a("path",{d:"M8 5v14l11-7z"})])],-1)])])):y("",!0)])),d.value?(s(),o("video",{key:1,class:"object-cover w-full h-full rounded-md",src:e.video,autoplay:"",muted:"",playsinline:"",controls:""},null,8,We)):y("",!0),a("div",null,[a("p",{class:"text-sm truncate px-0.5 mt-1.5 text-white",title:e.name},I(e.name),9,Ye)])]))}}),tt=q({__name:"ItemsSkeleton",props:{numberItems:{default:30}},setup(e){return(d,t)=>(s(!0),o(P,null,j(e.numberItems,v=>(s(),o("div",{key:`skeleton-${v}`,class:"flex flex-col min-h-[10rem]"},[...t[0]||(t[0]=[a("div",{class:"block rounded-md animate-pulse h-5/6 bg-black-300"},null,-1),a("div",{class:"bg-black-300 rounded-md h-1/6 mt-1.5 animate-pulse"},null,-1)])]))),128))}}),lt={class:"relative flex-1 w-full"},st={key:3,class:"py-10"},nt=q({__name:"ItemsList",props:{items:{},itemsCount:{},loading:{type:Boolean},search:{},sortBy:{default:""},hasFilters:{type:Boolean,default:!1},hasSelectedFilters:{type:Boolean,default:!1},filters:{},filtersValues:{},isVideo:{type:Boolean,default:!1},hasSearch:{type:Boolean,default:!0}},emits:["set-query","set-sort-by","select","load-more","open-filters","remove-filter"],setup(e,{emit:d}){const t=d,v=x(null),{y:l}=se(v),u=x(!1);function r(c){u.value=c,c===!0&&t("load-more")}return(c,i)=>(s(),o("div",lt,[e.hasSearch?(s(),N(Ne,{key:0,query:e.search,"scrolled-down":m(l)>40,total:e.itemsCount,loading:e.loading,"has-filters":e.hasFilters,"has-selected-filters":e.hasSelectedFilters,"sort-by":e.sortBy,filters:e.filters,"filters-values":e.filtersValues,onInput:i[0]||(i[0]=n=>c.$emit("set-query",n)),onSetSortBy:i[1]||(i[1]=n=>c.$emit("set-sort-by",n)),onOpenFilters:i[2]||(i[2]=n=>c.$emit("open-filters")),onRemoveFilter:i[3]||(i[3]=n=>c.$emit("remove-filter",n))},null,8,["query","scrolled-down","total","loading","has-filters","has-selected-filters","sort-by","filters","filters-values"])):y("",!0),a("div",{ref_key:"el",ref:v,class:z(["grid w-full gap-3 p-4 px-5 pb-32 mx-auto overflow-y-scroll h-[calc(100vh-69px)]",{"grid-cols-1 lg:grid-cols-2 xl:grid-cols-3":e.isVideo,"items-grid-small md:items-grid":!e.isVideo}])},[e.isVideo?(s(!0),o(P,{key:1},j(e.items,n=>(s(),N(et,{key:n.id,name:n.name,video:n.video,thumbnail:n.thumbnail},null,8,["name","video","thumbnail"]))),128)):(s(!0),o(P,{key:0},j(e.items,n=>(s(),N(Ke,{id:n.id,key:n.id,name:n.name,image:n.image,souvenir:n?.souvenir??!1,stattrak:n?.stattrak??!1,genuine:n?.genuine??!1,phase:n?.phase??null,"market-hash-name":n.market_hash_name,onShow:f=>c.$emit("select",n.id)},null,8,["id","name","image","souvenir","stattrak","genuine","phase","market-hash-name","onShow"]))),128)),e.loading?(s(),N(tt,{key:2})):y("",!0),e.loading?y("",!0):A((s(),o("div",st,null,512)),[[m(ne),r]])],2)]))}}),at=["value","checked","onChange"],rt=q({__name:"MultiSelectFilter",props:{options:{},values:{}},emits:["update:values"],setup(e,{emit:d}){const t=e,v=d,l=x(""),u=$(()=>t.options.filter(i=>i.name.toLocaleLowerCase().includes(l.value.toLocaleLowerCase()))),r=i=>{const n=t.values,f=n.indexOf(i);f===-1?n.push(i):n.splice(f,1),v("update:values",n)},c=i=>t.values.includes(i);return(i,n)=>(s(),o("div",null,[A(a("input",{"onUpdate:modelValue":n[0]||(n[0]=f=>l.value=f),class:"w-full h-full py-3 text-white rounded-md outline-none bg-black-300 border-2 border-black-300 focus:outline-none mb-4 sm:text-sm focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent",type:"text",placeholder:"Search to filter..."},null,512),[[U,l.value]]),(s(!0),o(P,null,j(u.value,f=>(s(),o("label",{key:f.id,class:"flex items-center gap-2 p-2 text-gray-300 rounded-md cursor-pointer hover:bg-black-300"},[a("input",{type:"checkbox",class:"w-4 h-4 text-[#ff5e65] border-gray-300 rounded focus:ring-[#ff5e65]",value:f.id,checked:c(f.id),onChange:S=>r(f.id)},null,40,at),T(" "+I(f.name),1)]))),128))]))}}),ot={class:"flex flex-col gap-4"},it={class:"px-1 pt-2 pb-4"},ut={class:"relative h-1.5"},ct=["value"],dt=["value"],ft={class:"flex items-center gap-3"},vt={class:"relative flex-1"},mt={class:"relative flex-1"},L=3e5,O=100,pt=q({__name:"PriceRangeFilter",props:{values:{}},emits:["update:values"],setup(e,{emit:d}){const t=e,v=d,l=x(""),u=x(""),r=$(()=>{const g=parseFloat(l.value);return g?Math.round(g*100):0}),c=$(()=>{const g=parseFloat(u.value);return g?Math.round(g*100):0}),i=$(()=>Math.min(r.value,L)),n=$(()=>c.value?Math.min(c.value,L):L),f=$(()=>{const g=i.value/L*100,h=100-n.value/L*100;return{left:`${g}%`,right:`${h}%`}});J(()=>{if(t.values.length===2){const g=Number(t.values[0]),h=Number(t.values[1]);g&&(l.value=(g/100).toFixed(2)),h&&(u.value=(h/100).toFixed(2))}});function S(g){const h=parseInt(g.target.value),V=Math.min(h,n.value-O);l.value=V<=0?"":(V/100).toFixed(2),F()}function D(g){const h=parseInt(g.target.value),V=Math.max(h,i.value+O);u.value=V>=L?"":(V/100).toFixed(2),F()}function E(){F()}function B(){l.value="",u.value="",F()}function F(){if(!r.value&&!c.value){v("update:values",[]);return}v("update:values",[String(r.value),String(c.value)])}return(g,h)=>(s(),o("div",ot,[a("div",it,[a("div",ut,[h[2]||(h[2]=a("div",{class:"absolute w-full h-full rounded-full bg-black-300"},null,-1)),a("div",{class:"absolute h-full rounded-full bg-[#ff5e65]",style:oe(f.value)},null,4),a("input",{type:"range",min:0,max:L,step:O,value:i.value,"aria-label":"Minimum price",class:z(["slider-thumb",{"z-[5]":i.value>L-O}]),onInput:S},null,42,ct),a("input",{type:"range",min:0,max:L,step:O,value:n.value,"aria-label":"Maximum price",class:"slider-thumb",onInput:D},null,40,dt)])]),a("div",ft,[a("div",vt,[h[3]||(h[3]=a("span",{class:"absolute text-sm text-black-100 left-3 top-1/2 -translate-y-1/2 pointer-events-none select-none"},"$",-1)),A(a("input",{"onUpdate:modelValue":h[0]||(h[0]=V=>l.value=V),class:"w-full py-2 pl-7 pr-3 text-white text-sm rounded-md bg-black-300 border-2 border-black-300 outline-none focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent placeholder:text-black-200 no-spinner",type:"number",min:"0",step:"0.01",placeholder:"Min",onInput:E},null,544),[[U,l.value]])]),h[5]||(h[5]=a("span",{class:"text-xs text-black-200 select-none"},"to",-1)),a("div",mt,[h[4]||(h[4]=a("span",{class:"absolute text-sm text-black-100 left-3 top-1/2 -translate-y-1/2 pointer-events-none select-none"},"$",-1)),A(a("input",{"onUpdate:modelValue":h[1]||(h[1]=V=>u.value=V),class:"w-full py-2 pl-7 pr-3 text-white text-sm rounded-md bg-black-300 border-2 border-black-300 outline-none focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent placeholder:text-black-200 no-spinner",type:"number",min:"0",step:"0.01",placeholder:"Max",onInput:E},null,544),[[U,u.value]])])]),l.value||u.value?(s(),o("button",{key:0,class:"self-end text-xs text-black-100 hover:text-white transition-colors cursor-pointer",onClick:B}," Clear ")):y("",!0)]))}}),ht=(e,d)=>{const t=e.__vccOpts||e;for(const[v,l]of d)t[v]=l;return t},bt=ht(pt,[["__scopeId","data-v-9ca18a7c"]]),gt={key:0},yt={key:1},xt=q({__name:"FiltersPanelControl",props:{prop:{},name:{},type:{},options:{},values:{}},emits:["close","update:values"],setup(e){return(d,t)=>e.type==="multi-select"?(s(),o("div",gt,[C(rt,{options:e.options,values:e.values,"onUpdate:values":t[0]||(t[0]=v=>d.$emit("update:values",{prop:e.prop,value:v}))},null,8,["options","values"])])):e.type==="price-range"?(s(),o("div",yt,[C(bt,{values:e.values,"onUpdate:values":t[1]||(t[1]=v=>d.$emit("update:values",{prop:e.prop,value:v}))},null,8,["values"])])):y("",!0)}}),kt={class:"h-dvh md:border-l-2 border-black-300 md:w-80 flex-shrink-0 xl:w-[30rem] flex flex-col absolute inset-0 md:relative bg-black-400 z-50"},wt={class:"flex items-center w-full h-[69px] border-b-2 border-black-300 px-4 sticky top-0 text-black-100"},$t={class:"h-[calc(100vh-69px)] py-4 pt-0 overflow-x-hidden"},Ft=["onClick"],St={key:0,class:"text-sm font-normal text-black-100"},Vt=q({__name:"FiltersPanel",props:{filters:{},filtersValues:{}},emits:["close","set-filters","remove-filters"],setup(e){const d=x({price_range:!0});return(t,v)=>(s(),o("div",kt,[a("div",wt,[a("button",{class:"ml-auto disabled:cursor-wait",onClick:v[0]||(v[0]=l=>t.$emit("close"))},[C(m(X),{class:"w-6 h-6 text-white"})])]),a("div",$t,[a("div",null,[(s(!0),o(P,null,j(e.filters,l=>(s(),o("div",{key:l.prop},[a("button",{class:"sticky top-0 flex items-center justify-between w-full p-4 font-semibold text-gray-100 border-b-2 border-black-300 bg-black-400",onClick:u=>d.value[l.prop]=!d.value[l.prop]},[a("div",null,[T(I(l.name)+" ",1),l.type!=="price-range"?(s(),o("span",St,"("+I(e.filtersValues[l.prop]?.length?`${e.filtersValues[l.prop].length}/${l.options.length}`:l.options.length)+")",1)):y("",!0)]),C(m(ke),{class:z(["w-6 h-6 duration-300 text-black-200",{"rotate-180":d.value[l.prop]}])},null,8,["class"])],8,Ft),d.value[l.prop]?(s(),o("div",{key:0,class:z(["p-4",{"border-b-2 border-black-300":d.value}])},[C(xt,{prop:l.prop,name:l.name,type:l.type,options:l.options,values:e.filtersValues[l.prop]??[],"onUpdate:values":v[1]||(v[1]=u=>t.$emit("set-filters",u))},null,8,["prop","name","type","options","values"])],2)):y("",!0)]))),128))])])]))}}),Bt=({query:e})=>d=>ie(`list/${d}`,()=>{const t=ue(),v=ce(),l=W(),u=x(!1),r=x(""),c=x(""),i=x(1),n=x([]),f=x([]),S=x([]),D=x(0),E=x([]),B=x({});function F(){if(!c.value)return;const p=c.value==="price-asc"?1:-1;f.value.sort((k,b)=>{const w=l.prices[k.market_hash_name]??null,M=l.prices[b.market_hash_name]??null;return w===null&&M===null?0:w===null?1:M===null?-1:(w-M)*p})}function g(){i.value=1,S.value=f.value.slice(0,20)}function h(){const p=B.value.price_range;if(p?.length===2){const[k,b]=p.map(Number);f.value=n.value.filter(w=>{const M=l.prices[w.market_hash_name];return!(M==null||k&&M<k||b&&M>b)})}else f.value=[...n.value];F(),D.value=f.value.length,g()}async function V(){G(),u.value=!0,i.value=1;try{const{price_range:p,...k}=B.value,{items:b,filters:w}=await e({search:r.value,filters:k});if(n.value=b,f.value=[...b],p?.length===2){const[M,Z]=p.map(Number);f.value=f.value.filter(le=>{const Q=l.prices[le.market_hash_name];return!(Q==null||M&&Q<M||Z&&Q>Z)})}F(),D.value=f.value.length,S.value=f.value.slice((i.value-1)*20,i.value*20),E.value=w??[]}catch(p){console.error(p instanceof Error?p.message:"An unknown error occurred")}finally{u.value=!1}}async function H(){i.value+=1,S.value.push(...f.value.slice((i.value-1)*20,i.value*20))}function K(p){G(),r.value=p,V(),R()}function Y({prop:p,value:k}){k.length===0?delete B.value[p]:B.value[p]=k,R()}function ee(){B.value={},R()}function te(p){c.value=p,F(),g(),R()}function G(){S.value=[],f.value=[],n.value=[],D.value=0}function R(){const p={};Object.entries(t.query).forEach(([k,b])=>{b!=null&&(Array.isArray(b)?p[k]=b.filter(w=>w!==null):typeof b=="string"&&(p[k]=b))}),r.value.length?p.q=r.value:delete p.q,c.value?p.sort=c.value:delete p.sort,Object.entries(B.value).forEach(([k,b])=>{b.length?p[k]=b:delete p[k]}),v.push({query:p})}return J(()=>{B.value={},r.value="",c.value="";const p=typeof t.query.q=="string"?t.query.q:"";r.value=p;const k=typeof t.query.sort=="string"?t.query.sort:"";(k==="price-asc"||k==="price-desc")&&(c.value=k),Object.entries(t.query).forEach(([b,w])=>{b!=="q"&&b!=="itemId"&&b!=="sort"&&w&&(typeof w=="string"?B.value[b]=w.includes(",")?w.split(","):[w]:Array.isArray(w)&&(B.value[b]=w))}),V()}),de(()=>{fe()?._s?.forEach(p=>{p.$id===`list/${d}`&&(p.$dispose(),K(""))}),v.push({query:{}})}),{items:S,itemsCount:D,search:r,sortBy:c,loading:u,filters:E,filtersValues:B,fetch:V,applyPriceFilter:h,loadMore:H,setSearch:K,setSortBy:te,setFilters:Y,removeFilters:ee}});function Ct(e){const{query:d,storeId:t,title:v,filterTransform:l}=e,u=ge(),r=Bt({query:d})(t)(),c=x(!1),i=$(()=>l?l(r.filters):r.filters);function n(){u.deleteItem(),c.value=!0}function f(){c.value=!1}function S(F){c.value=!1,u.getItemDetails(F)}function D({prop:F,value:g}){r.setFilters({prop:F,value:g}),F==="price_range"?r.applyPriceFilter():r.fetch()}function E(){r.removeFilters(),r.fetch()}function B({prop:F,value:g}){const V=(r.filtersValues[F]??[]).filter(H=>H!==g);r.setFilters({prop:F,value:V}),r.fetch()}return ye(v),{items:$(()=>r.items),itemsCount:$(()=>r.itemsCount),loading:$(()=>r.loading),search:$(()=>r.search),filters:i,filtersValues:$(()=>r.filtersValues),hasFilters:$(()=>i.value.length>0),hasSelectedFilters:$(()=>Object.keys(r.filtersValues).length>0),showFilters:c,sortBy:$(()=>r.sortBy),setSortBy:r.setSortBy,setSearch:r.setSearch,loadMore:r.loadMore,openFilters:n,closeFilters:f,selectItem:S,setFilters:D,removeFilters:E,removeFilter:B}}const It={class:"flex flex-row flex-1"},jt=q({__name:"BaseItemListView",props:{query:{},storeId:{},title:{},filterTransform:{type:Function,default:void 0},isVideo:{type:Boolean,default:!1}},setup(e){const d=e,t=Ct({query:d.query,storeId:d.storeId,title:d.title,filterTransform:d.filterTransform});return(v,l)=>(s(),o("div",It,[C(nt,{items:m(t).items.value,"items-count":m(t).itemsCount.value,loading:m(t).loading.value,search:m(t).search.value,"has-filters":m(t).hasFilters.value,"has-selected-filters":m(t).hasSelectedFilters.value,filters:m(t).filters.value,"filters-values":m(t).filtersValues.value,"is-video":e.isVideo,"sort-by":m(t).sortBy.value,onSetSortBy:l[0]||(l[0]=u=>m(t).setSortBy(u)),onSetQuery:l[1]||(l[1]=u=>m(t).setSearch(u)),onSelect:m(t).selectItem,onLoadMore:l[2]||(l[2]=u=>m(t).loadMore()),onOpenFilters:l[3]||(l[3]=u=>m(t).openFilters()),onRemoveFilter:m(t).removeFilter},null,8,["items","items-count","loading","search","has-filters","has-selected-filters","filters","filters-values","is-video","sort-by","onSelect","onRemoveFilter"]),m(t).showFilters.value?(s(),N(Vt,{key:0,filters:m(t).filters.value,"filters-values":m(t).filtersValues.value,onSetFilters:m(t).setFilters,onRemoveFilters:m(t).removeFilters,onClose:l[4]||(l[4]=u=>m(t).closeFilters())},null,8,["filters","filters-values","onSetFilters","onRemoveFilters"])):y("",!0)]))}});export{jt as _};
