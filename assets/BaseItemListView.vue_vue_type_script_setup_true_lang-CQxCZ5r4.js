import{a as i,b as m,o as l,d as V,n as b,w as U,p as O,q as y,s as z,e as $,g as f,f as A,t as F,v as D,x as N,F as S,r as C,y as R,z as P,i as L,A as Q,c as w,B as K,C as Z,D as G,E as H,G as J,I as W,u as X}from"./index-DcLhUKBH.js";import{a as Y,_}from"./ItemsSkeleton.vue_vue_type_script_setup_true_lang-Ee0BoeV-.js";import{u as ee}from"./useTitle-Bn7wtzFb.js";function te(e,a){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function se(e,a){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}function le(e,a){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const oe={class:"relative"},ne={class:"absolute left-0 flex items-center h-full px-2"},re={class:"absolute right-0 flex items-center h-full gap-2 px-3"},ie={key:0,class:"px-2 text-sm text-white rounded-md bg-black-200 hidden sm:block"},ae={class:"font-semibold"},ue={key:1,class:"w-20 h-6 px-2 rounded-md bg-black-200 animate-pulse"},de={key:2,class:"w-0.5 h-[calc(100%-20px)] rounded-full bg-black-200/20"},ce={key:0,class:"absolute top-1 right-1 bg-[#ff5e65] size-2 rounded-full"},fe={key:0,class:"flex gap-2 overflow-x-auto pb-0.5"},me={class:""},ve={class:"flex items-center gap-1 flex-wrap"},he=["onClick"],pe=V({__name:"SearchBar",props:{query:{},total:{},scrolledDown:{type:Boolean},hasFilters:{type:Boolean},hasSelectedFilters:{type:Boolean},loading:{type:Boolean},filters:{},filtersValues:{}},emits:["input","open-filters","remove-filter"],setup(e){const a=e,t=b(a.query||"");return U(()=>a.query,u=>{t.value=u}),(u,s)=>(l(),i("div",{class:O(["sticky top-0 left-0 right-0 px-5 pt-3 pb-2 duration-300 z-10 gap-2 flex flex-col",[e.scrolledDown?"bg-black-300 shadow-lg":"bg-transparent"]])},[m("div",oe,[m("div",ne,[$(f(le),{class:"w-6 h-6 text-black-200"})]),m("div",re,[e.loading?(l(),i("div",ue)):(l(),i("p",ie,[s[3]||(s[3]=A(" total ",-1)),m("span",ae,F(e.total),1)])),e.hasFilters?(l(),i("div",de)):y("",!0),e.hasFilters?(l(),i("button",{key:3,type:"button",class:"p-1 rounded-md hover:bg-black-200 relative",onClick:s[0]||(s[0]=n=>u.$emit("open-filters"))},[$(f(se),{class:"w-6 h-6 text-black-100"}),e.hasSelectedFilters?(l(),i("div",ce)):y("",!0)])):y("",!0)]),z(m("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>t.value=n),class:"w-full h-full py-4 pl-12 pr-36 sm:pr-60 text-white border-0 rounded-md outline-none bg-black-300 focus:outline-none sm:text-sm focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent",type:"text",placeholder:"Search...",onKeyup:s[2]||(s[2]=N(n=>u.$emit("input",t.value),["enter"]))},null,544),[[D,t.value]])]),e.hasSelectedFilters?(l(),i("div",fe,[(l(!0),i(S,null,C(e.filtersValues,(n,o)=>(l(),i("div",{key:o,class:"flex items-center gap-1 text-sm p-1 flex-shrink-0 text-white rounded-md bg-black-300"},[m("div",me,F(e.filters.find(d=>d.prop===o)?.name||o),1),m("div",ve,[(l(!0),i(S,null,C(n,d=>(l(),i("button",{key:d,type:"button",class:"text-white bg-black-200 px-1 rounded-md flex items-center gap-1",onClick:c=>u.$emit("remove-filter",{prop:o,value:d})},[$(f(R),{class:"size-4 text-white"}),A(" "+F(e.filters.find(c=>c.prop===o)?.options.find(c=>c.id===d)?.name||d),1)],8,he))),128))])]))),128))])):y("",!0)],2))}}),be={class:"flex flex-col"},ge=["src","alt"],ye={key:0,class:"absolute inset-0 bg-black-300 rounded-md animate-pulse"},ke={key:1,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-20 rounded-md"},we=["src"],xe=["title"],$e=V({__name:"ItemVideo",props:{name:{},video:{},thumbnail:{}},emits:["show"],setup(e){const a=b(!1),t=b(!1);function u(){a.value=!0}return(s,n)=>(l(),i("div",be,[a.value?y("",!0):(l(),i("div",{key:0,class:"relative w-full aspect-video rounded-md cursor-pointer bg-gray-800",onClick:u},[m("img",{src:e.thumbnail,alt:e.name,class:"w-full h-full object-cover rounded-md",loading:"lazy",onLoad:n[0]||(n[0]=o=>t.value=!0),onError:n[1]||(n[1]=o=>t.value=!0)},null,40,ge),t.value?y("",!0):(l(),i("div",ye)),t.value?(l(),i("div",ke,[...n[2]||(n[2]=[m("div",{class:"w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center hover:bg-opacity-100 transition-all"},[m("svg",{class:"w-8 h-8 text-black ml-1",fill:"currentColor",viewBox:"0 0 24 24"},[m("path",{d:"M8 5v14l11-7z"})])],-1)])])):y("",!0)])),a.value?(l(),i("video",{key:1,class:"object-cover w-full h-full rounded-md",src:e.video,autoplay:"",muted:"",playsinline:"",controls:""},null,8,we)):y("",!0),m("div",null,[m("p",{class:"text-sm truncate px-0.5 mt-1.5 text-white",title:e.name},F(e.name),9,xe)])]))}}),Fe={class:"relative flex-1 w-full"},Ve={key:3,class:"py-10"},Se=V({__name:"ItemsList",props:{items:{},itemsCount:{},loading:{type:Boolean},search:{},hasFilters:{type:Boolean,default:!1},hasSelectedFilters:{type:Boolean,default:!1},filters:{},filtersValues:{},isVideo:{type:Boolean,default:!1},hasSearch:{type:Boolean,default:!0}},emits:["set-query","select","load-more","open-filters","remove-filter"],setup(e,{emit:a}){const t=a,u=b(null),{y:s}=P(u),n=b(!1);function o(d){n.value=d,d===!0&&t("load-more")}return(d,c)=>(l(),i("div",Fe,[e.hasSearch?(l(),L(pe,{key:0,query:e.search,"scrolled-down":f(s)>40,total:e.itemsCount,loading:e.loading,"has-filters":e.hasFilters,"has-selected-filters":e.hasSelectedFilters,filters:e.filters,"filters-values":e.filtersValues,onInput:c[0]||(c[0]=r=>d.$emit("set-query",r)),onOpenFilters:c[1]||(c[1]=r=>d.$emit("open-filters")),onRemoveFilter:c[2]||(c[2]=r=>d.$emit("remove-filter",r))},null,8,["query","scrolled-down","total","loading","has-filters","has-selected-filters","filters","filters-values"])):y("",!0),m("div",{ref_key:"el",ref:u,class:O(["grid w-full gap-3 p-4 px-5 pb-32 mx-auto overflow-y-scroll h-[calc(100vh-69px)]",{"grid-cols-1 lg:grid-cols-2 xl:grid-cols-3":e.isVideo,"items-grid-small md:items-grid":!e.isVideo}])},[e.isVideo?(l(!0),i(S,{key:1},C(e.items,r=>(l(),L($e,{key:r.id,name:r.name,video:r.video,thumbnail:r.thumbnail},null,8,["name","video","thumbnail"]))),128)):(l(!0),i(S,{key:0},C(e.items,r=>(l(),L(_,{id:r.id,key:r.id,name:r.name,image:r.image,souvenir:r?.souvenir??!1,stattrak:r?.stattrak??!1,rare:r?.rare??!1,genuine:r?.genuine??!1,"market-hash-name":r.market_hash_name,onShow:p=>d.$emit("select",r.id)},null,8,["id","name","image","souvenir","stattrak","rare","genuine","market-hash-name","onShow"]))),128)),e.loading?(l(),L(Y,{key:2})):y("",!0),e.loading?y("",!0):z((l(),i("div",Ve,null,512)),[[f(Q),o]])],2)]))}}),Ce=["value","checked","onChange"],qe=V({__name:"MultiSelectFilter",props:{options:{},values:{}},emits:["update:values"],setup(e,{emit:a}){const t=e,u=a,s=b(""),n=w(()=>t.options.filter(c=>c.name.toLocaleLowerCase().includes(s.value.toLocaleLowerCase()))),o=c=>{const r=t.values,p=r.indexOf(c);p===-1?r.push(c):r.splice(p,1),u("update:values",r)},d=c=>t.values.includes(c);return(c,r)=>(l(),i("div",null,[z(m("input",{"onUpdate:modelValue":r[0]||(r[0]=p=>s.value=p),class:"w-full h-full py-3 text-white rounded-md outline-none bg-black-300 border-2 border-black-300 focus:outline-none mb-4 sm:text-sm focus:ring-2 focus:ring-[#ff5e65] focus:border-transparent",type:"text",placeholder:"Search to filter..."},null,512),[[D,s.value]]),(l(!0),i(S,null,C(n.value,p=>(l(),i("label",{key:p.id,class:"flex items-center gap-2 p-2 text-gray-300 rounded-md cursor-pointer hover:bg-black-300"},[m("input",{type:"checkbox",class:"w-4 h-4 text-[#ff5e65] border-gray-300 rounded focus:ring-[#ff5e65]",value:p.id,checked:d(p.id),onChange:k=>o(p.id)},null,40,Ce),A(" "+F(p.name),1)]))),128))]))}}),Be={key:0},Ie=V({__name:"FiltersPanelControl",props:{prop:{},name:{},type:{},options:{},values:{}},emits:["close","update:values"],setup(e){return(a,t)=>e.type==="multi-select"?(l(),i("div",Be,[$(qe,{options:e.options,values:e.values,"onUpdate:values":t[0]||(t[0]=u=>a.$emit("update:values",{prop:e.prop,value:u}))},null,8,["options","values"])])):y("",!0)}}),Le={class:"h-dvh md:border-l-2 border-black-300 md:w-80 flex-shrink-0 xl:w-[30rem] flex flex-col absolute inset-0 md:relative bg-black-400 z-50"},je={class:"flex items-center w-full h-[69px] border-b-2 border-black-300 px-4 sticky top-0 text-black-100"},Oe={class:"h-[calc(100vh-69px)] py-4 pt-0 overflow-x-hidden"},Ae=["onClick"],Ee={class:"text-sm font-normal text-black-100"},Me=V({__name:"FiltersPanel",props:{filters:{},filtersValues:{}},emits:["close","set-filters","remove-filters"],setup(e){const a=b({});return(t,u)=>(l(),i("div",Le,[m("div",je,[m("button",{class:"ml-auto disabled:cursor-wait",onClick:u[0]||(u[0]=s=>t.$emit("close"))},[$(f(R),{class:"w-6 h-6 text-white"})])]),m("div",Oe,[Object.keys(e.filtersValues).length>0?(l(),i("button",{key:0,type:"button",class:"w-full py-2 mb-2 font-semibold text-red-800 border-y-2 border-red-800/20 bg-red-900/20 hover:bg-red-900/30",onClick:u[1]||(u[1]=s=>t.$emit("remove-filters"))}," Remove all selected filters ")):y("",!0),m("div",null,[(l(!0),i(S,null,C(e.filters,s=>(l(),i("div",{key:s.prop},[m("button",{class:"sticky top-0 flex items-center justify-between w-full p-4 font-semibold text-gray-100 border-b-2 border-black-300 bg-black-400",onClick:n=>a.value[s.prop]=!a.value[s.prop]},[m("div",null,[A(F(s.name)+" ",1),m("span",Ee,"("+F(e.filtersValues[s.prop]?.length?`${e.filtersValues[s.prop].length}/${s.options.length}`:s.options.length)+")",1)]),$(f(te),{class:O(["w-6 h-6 duration-300 text-black-200",{"rotate-180":a.value[s.prop]}])},null,8,["class"])],8,Ae),a.value[s.prop]?(l(),i("div",{key:0,class:O(["p-4",{"border-b-2 border-black-300":a.value}])},[$(Ie,{prop:s.prop,name:s.name,type:s.type,options:s.options,values:e.filtersValues[s.prop]??[],"onUpdate:values":u[2]||(u[2]=n=>t.$emit("set-filters",n))},null,8,["prop","name","type","options","values"])],2)):y("",!0)]))),128))])])]))}}),ze=({query:e})=>a=>K(`list/${a}`,()=>{const t=Z(),u=G(),s=b(!1),n=b(""),o=b(1),d=b([]),c=b([]),r=b(0),p=b([]),k=b({});async function q(){M(),s.value=!0,o.value=1;try{const{items:v,filters:g}=await e({search:n.value,filters:k.value});d.value=v,r.value=d.value.length,c.value=d.value.slice((o.value-1)*20,o.value*20),p.value=g??[]}catch(v){console.error(v instanceof Error?v.message:"An unknown error occurred")}finally{s.value=!1}}async function E(){o.value+=1,c.value.push(...d.value.slice((o.value-1)*20,o.value*20))}function j(v){M(),n.value=v,q(),I()}function x({prop:v,value:g}){g.length===0?delete k.value[v]:k.value[v]=g,I()}function B(){k.value={},I()}function M(){c.value=[],d.value=[],r.value=0}function I(){const v={};Object.entries(t.query).forEach(([g,h])=>{h!=null&&(Array.isArray(h)?v[g]=h.filter(T=>T!==null):typeof h=="string"&&(v[g]=h))}),n.value.length?v.q=n.value:delete v.q,Object.entries(k.value).forEach(([g,h])=>{h.length?v[g]=h:delete v[g]}),u.push({query:v})}return H(()=>{k.value={},n.value="";const v=typeof t.query.q=="string"?t.query.q:"";n.value=v,Object.entries(t.query).forEach(([g,h])=>{g!=="q"&&g!=="itemId"&&h&&(typeof h=="string"?k.value[g]=h.includes(",")?h.split(","):[h]:Array.isArray(h)&&(k.value[g]=h))}),q()}),J(()=>{W()?._s?.forEach(v=>{v.$id===`list/${a}`&&(v.$dispose(),j(""))}),u.push({query:{}})}),{items:c,itemsCount:r,search:n,loading:s,filters:p,filtersValues:k,fetch:q,loadMore:E,setSearch:j,setFilters:x,removeFilters:B}});function De(e){const{query:a,storeId:t,title:u,filterTransform:s}=e,n=X(),o=ze({query:a})(t)(),d=b(!1),c=w(()=>s?s(o.filters):o.filters);function r(){n.deleteItem(),d.value=!0}function p(){d.value=!1}function k(x){d.value=!1,n.getItemDetails(x)}function q({prop:x,value:B}){o.setFilters({prop:x,value:B}),o.fetch()}function E(){o.removeFilters(),o.fetch()}function j({prop:x,value:B}){const I=(o.filtersValues[x]??[]).filter(v=>v!==B);o.setFilters({prop:x,value:I}),o.fetch()}return ee(u),{items:w(()=>o.items),itemsCount:w(()=>o.itemsCount),loading:w(()=>o.loading),search:w(()=>o.search),filters:c,filtersValues:w(()=>o.filtersValues),hasFilters:w(()=>c.value.length>0),hasSelectedFilters:w(()=>Object.keys(o.filtersValues).length>0),showFilters:d,setSearch:o.setSearch,loadMore:o.loadMore,openFilters:r,closeFilters:p,selectItem:k,setFilters:q,removeFilters:E,removeFilter:j}}const Re={class:"flex flex-row flex-1"},Pe=V({__name:"BaseItemListView",props:{query:{},storeId:{},title:{},filterTransform:{type:Function,default:void 0},isVideo:{type:Boolean,default:!1}},setup(e){const a=e,t=De({query:a.query,storeId:a.storeId,title:a.title,filterTransform:a.filterTransform});return(u,s)=>(l(),i("div",Re,[$(Se,{items:f(t).items.value,"items-count":f(t).itemsCount.value,loading:f(t).loading.value,search:f(t).search.value,"has-filters":f(t).hasFilters.value,"has-selected-filters":f(t).hasSelectedFilters.value,filters:f(t).filters.value,"filters-values":f(t).filtersValues.value,"is-video":e.isVideo,onSetQuery:s[0]||(s[0]=n=>f(t).setSearch(n)),onSelect:f(t).selectItem,onLoadMore:s[1]||(s[1]=n=>f(t).loadMore()),onOpenFilters:s[2]||(s[2]=n=>f(t).openFilters()),onRemoveFilter:f(t).removeFilter},null,8,["items","items-count","loading","search","has-filters","has-selected-filters","filters","filters-values","is-video","onSelect","onRemoveFilter"]),f(t).showFilters.value?(l(),L(Me,{key:0,filters:f(t).filters.value,"filters-values":f(t).filtersValues.value,onSetFilters:f(t).setFilters,onRemoveFilters:f(t).removeFilters,onClose:s[3]||(s[3]=n=>f(t).closeFilters())},null,8,["filters","filters-values","onSetFilters","onRemoveFilters"])):y("",!0)]))}});export{Pe as _};
